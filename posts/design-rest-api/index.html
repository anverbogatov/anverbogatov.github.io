<!doctype html><html lang=ru><head><title>Как проектировать REST API? :: Anver Bogatov</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Данная статья доступно объясняет простой и, самое главное, рабочий способ проектирования новых REST API для приложений."><meta name=keywords content="api,design,restapi"><meta name=robots content="noodp"><link rel=canonical href=/posts/design-rest-api/><script async src="https://www.googletagmanager.com/gtag/js?id=G-QX8WGB4JN0"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QX8WGB4JN0',{anonymize_ip:!1})}</script><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="ru"><meta property="og:type" content="article"><meta property="og:title" content="Как проектировать REST API?"><meta property="og:description" content="Данная статья доступно объясняет простой и, самое главное, рабочий способ проектирования новых REST API для приложений."><meta property="og:url" content="/posts/design-rest-api/"><meta property="og:site_name" content="Anver Bogatov"><meta property="og:image" content="/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2021-10-03 18:55:34 +0400 +0400"></head><body class=green><div class="container full headings--one-size"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-QX8WGB4JN0"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QX8WGB4JN0',{anonymize_ip:!1})}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-QX8WGB4JN0','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Anver Bogatov</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>Обо мне</a></li><li><a href=/showcase>Статьи</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>Обо мне</a></li><li><a href=/showcase>Статьи</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/design-rest-api/>Как проектировать REST API?</a></h1><div class=post-meta><span class=post-date>2021-10-03</span>
<span class=post-author>:: Анвер Богатов</span></div><span class=post-tags>#<a href=/tags/design/>design</a>&nbsp;
#<a href=/tags/restapi/>restapi</a>&nbsp;</span><div class=post-content><div><pre><code>Изначально, это статью Я написал для своего блога на Medium [1]. 
Сюда переношу её почти без изменений.
</code></pre><h1 id=что-такое-api>Что такое API?<a href=#что-такое-api class=hanchor arialabel=Anchor>&#8983;</a></h1><p><strong>API или Application Programming Interface</strong> — это описание способа взаимодействия программ. Если быть точнее, это набор классов, интерфейсов, структур данных, которые объявлены программой. С помощью них можно заставить программу выполнять действия. Какие именно действия — описано как раз таки в API.</p><p><strong>API’ев существует огромное множество</strong>. Например, сама Java даёт разработчику доступ к десяткам API — Core API, Concurrency API, Collection API и много много других. Сторонние фреймворки тоже предоставляют свои API — Hibernate API, JPA (Java Persistence API), RestEasy и другие.</p><p><strong>У каждого API есть своя цель</strong>. API’и не делают просто так. Каждый API сродни пульту управления от телевизора. Он даёт возможность управлять программой. Например, программа для анализа использования дискового пространства может содержать API, который позволит получить статистику о файлах и занятом ими пространнстве; укажет на самый тяжёлый файл на диске и так далее. При этом каждое API не позволяет делать произвольные вещи. Все возможности API согласованы с его целью.</p><p><strong>API’и не привязаны к конкретной технологии</strong>. Если программа написана на Java это не означает, что API ограничен этим языком программирования. Приложение может предоставлять API, не привязанное к конкретной технологии, на которой оно построено. Пример — REST API.</p><h1 id=что-такое-rest-api>Что такое REST API?<a href=#что-такое-rest-api class=hanchor arialabel=Anchor>&#8983;</a></h1><p>REST или Representational State Transfer («передача состояния представления») это архитектурный подход, основанный на протоколе HTTP.</p><h1 id=зачем-проектировать-rest-api>Зачем проектировать REST API?<a href=#зачем-проектировать-rest-api class=hanchor arialabel=Anchor>&#8983;</a></h1><p><strong>Построение программ — это игра в конструктор без жёстких правил</strong>. Победить в этой игре могут все. Но настоящее искусство программиста это написание таких программ, которые будут работать быстро, безотказно и легко расширяться. Поэтому, как и при стройке дома, важно знать заранее что и как будет построено, ибо цена ошибки на этапе проектирование ниже, чем цена ошибки в момент, когда дом уже готов.</p><h1 id=предметно-ориентированное-проектирование-rest-api>Предметно-ориентированное проектирование REST API<a href=#предметно-ориентированное-проектирование-rest-api class=hanchor arialabel=Anchor>&#8983;</a></h1><p><strong>Техника, которой я сегодня поделюсь</strong> хорошо описана в книге издательства Manning — “The Design of Web APIs" [2]. Ссылку на книгу можно найти в конце статьи.</p><p><strong>Небольшая вводная</strong>, прежде чем мы приступим к рассмотрению методики. Все идеи и советы ниже крайне ориентированы на практику. Это не теоретические знания, это живой метод проектирования REST API, поэтому и разбирать мы его будем на живом примере. Представьте, что Нам нужно спроектировать REST API для блог-сервиса. Конкретно, Мы отвечаем за работу с постами и их комментариями. На примере этого требования мы и разберёмся с методом.</p><p><strong>Какие цели могут быть у такого API?</strong> Пожалуй их будет несколько:</p><ul><li>Прочитать имеющиеся посты. Должен быть способ получить список уже имеющихся постов.</li><li>Изменение имеющегося поста. Что если в текст прокралась ошибка? Автор должен иметь возможность её поправить после написания и публикации поста.</li><li>Создание нового поста. Как-то же пост попадает наш блогосервис.</li><li>Удаление поста. Автор решил удалить свой устаревший пост или пост с идеями, в которые он больше не верит.</li><li>Чтение комментариев к посту. Для краткости предположим что комментарии попадают в наш блогосервис каким-то иным способом, не через наше REST API. Однако, в нашем REST API мы хотим разрешить пользователям читать комментарии для имеющихся постов.</li></ul><p>Эти цели мы транслируем в REST API.</p><p><strong>Теперь разберёмся с основными правилами</strong>:</p><ul><li>Цели транслируются в <strong>ресурсы</strong> и <strong>действия</strong></li><li><strong>Ресурсы</strong> определяются путём в REST API, а <strong>действия</strong> определяются методами HTTP</li></ul><p><strong>Что такое ресурс?</strong> Ресурс это объект, представление, сущность, всё что угодно, что представляет данные в системе. В нашем блогосервисе ресурсов несколько — Пост и Комментарий.</p><p><strong>Что такое действие?</strong> Действие это способ заставить наш блогосервис что-то сделать, например — отдать список имеющихся постов, создать новый и так далее. Действия определяются методами HTTP протокола, как уже было сказано выше. Таких действий несколько, но нас интересуют стандартные: GET, POST, PUT, DELETE.</p><p><strong>Перейдём к самому проектированию</strong>. Разберём его по шагам:</p><ul><li>Перво-наперво нужно определить все ресурсы и под-ресурсы, с которыми наше API должно работать. В нашем случае это <strong>Пост</strong> и <strong>Комментарий</strong>.</li><li>Далее, нужно определить набор действий, которые наше API позволяет совершать над ресурсами. Для нас это:</li></ul><ol><li>GET Пост — для получения списка имеющихся постов</li><li>POST Пост — для создания нового поста</li><li>PUT Пост — для изменения имеющегося поста</li><li>DELETE Пост — для удаления поста</li><li>GET Комментарий — для получения списка комментариев поста</li></ol><ul><li>Определим набор параметров для действий, которые мы спроектировали выше:</li></ul><ol><li>Операция получения постов GET — может быть вызвана как без параметров, что приведёт к чтению всех имеющихся постов, так и с идентификатором конкретного поста для получения выбранного поста</li><li>Операция создания поста POST подразумевает, что в неё будет передана информация о посте, который необходимо создать</li><li>PUT требует двух параметров — идентификатора поста, который мы будем изменять и сам пост, который заменит имеющийся в блогосервисе</li><li>DELETE требует идентификатора поста, который необходимо удалить</li><li>Операция получения комментариев GET требует идентификатора поста, потому что мы хотим получить список комментариев к определённому посту</li></ol><p><strong>Прервёмся на секунду</strong>. Мы провели большую подготовительную работу для сбора данных о нашем будущем API. Теперь мы знаем как конкретно и с чем конкретно наше API будет работать. Но эту информацию стоит дополнить и на следующем шаге мы займёмся именно этим.</p><p>На какие ещё моменты нам стоит обратить внимание? Их несколько. Нужно ответить на следующие вопросы:</p><ul><li>Кто будет вызывать операции API?</li><li>Что и как будет делать этот кто-то с нашим API?</li></ul><p><strong>Небольшая ремарка</strong> — структура статьи на Medium не позволяет создать таблицу, хотя дальнейшую работу по проектированию нашего REST API я рекомендую проводить именно с таблицами. Поэтому дальше — мы в текстовом виде разберём что нам нужно делать, но я подразумеваю, что все моменты которые мы оговорим будут внесены в специальную таблицу.</p><p><strong>Наша таблица проектирования — наш помощник</strong>. Список её колонок следующий:</p><ul><li><strong>Кто</strong> — тут могут быть роли пользователей, которые будут работать с нашим API</li><li><strong>Что</strong> — имеется ввиду что делает пользователь с нашим API. Его ожидания</li><li><strong>Как</strong> — опять же, как наш пользователь достигает своей цели</li><li><strong>Входные данные</strong> — информацию, которую необходимо передать нашему API, для того, чтобы оно помогло пользователю достигнуть цели</li><li><strong>Выходные данные</strong> — информация, которую вернёт наш API в результате работы метода</li><li><strong>Цель</strong> — описывает явно смысл конкретной операции нашего API</li><li><strong>HTTP метод</strong> — указание на HTTP метод, который описывает действие нашего пользователя</li><li><strong>URI</strong> — путь по которому данная операция нашего API доступна клиентам</li></ul><p><img src=/images/design-rest-api/1.png alt=design-rest-api-table-1></p><p><strong>Всё что нам осталось сделать</strong>, это на основе информации, которую мы проговорили выше <strong>заполнить эту табличку</strong>. Попробуем сделать это для операции получения постов:</p><p><img src=/images/design-rest-api/2.png alt=design-rest-api-table-2></p><p><strong>Разберём подробнее</strong>. Раз уж мы работаем с постами, то кто-то их должен писать. Это будет Автор. Автор может получить доступ ко всем своим постам, поэтому для операции чтения постов нам не требуется никаких входных данных. Реализация самого API может установить текущего пользователя системы и определить авторство постов. На выходе же мы получим список постов, которые были написаны автором (или текущем залогиненным пользователем). Операция получения данных описывается в HTTP протоколе методом GET, а URI в конце, может иметь произвольную структуру, но общепринято в хвосте URL путь писать с указанием ресурса с которым в данном API мы работаем во множественном числе. В нашем случае это <code>…/posts</code>.</p><p><strong>По мере заполнения таблицы, всегда задаём себе вопросы</strong> — откуда берутся ресурсы, кто с ними работает и так далее. Чем шире посмотреть на имеющиеся данные, тем больше возможных кейсов можно идентифицировать на этапе проектирования. Простой пример — мы спроектировали операцию получения авторских постов. Но кто эти посты добавляет в систему? Очевидно, что авторы. Спроектируем и это:</p><p><img src=/images/design-rest-api/3.png alt=design-rest-api-table-3></p><p>Пользуясь этим подходом <strong>спроектируем оставшиеся операции</strong>:</p><p><img src=/images/design-rest-api/4.png alt=design-rest-api-table-4></p><p><strong>Обратите внимание на последнюю строку</strong>. Мы уже коснулись темы подресурсов выше. В таблице на картинке выше Вы можете заметить как выглядит URI для доступа к комментариям поста. В пути сначала пишется родительский ресурс, а потом уже указание на подресурс: <code>/api/[resource]/{id}/[sub-resource]</code>. Это общепринятая практика и подобное построение пути даёт возможность пользователям Вашего API сразу понять какие ресурсы зависят от других.</p><p><strong>В заключение, хочется задать вопрос — Подходит ли спроектированное нами API на все случаи жизни? Конечно же — нет</strong>. Если Вы присмотритесь к таблице внимательнее, станет ясно, что это API предназначено исключительно для Авторов постов. Автор может читать только свои посты. А вот пользователи блогосервиса должны получать доступ ко всем постам всех авторов. Такие вот моменты становятся видны, если на этапе проектирования каждой из операции задавать вопросы о том, кто будет пользоваться ими и в каких случаях.</p><p><strong>Надеюсь эта статья поможет Вам</strong> подступиться к такой огромной теме как REST API’и и направит Вас в моменты, когда придётся проектировать собственное API.</p><h1 id=полезные-ссылки>Полезные ссылки<a href=#полезные-ссылки class=hanchor arialabel=Anchor>&#8983;</a></h1><ul><li>[1] Мой старый <a href=https://anver-bogatov.medium.com/%D0%BA%D0%B0%D0%BA-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D1%82%D1%8C-rest-api-86b2d6737401>блог на Medium</a></li><li>[2] Книга &ldquo;The Design of Web APIs&rdquo; <a href=https://www.manning.com/books/the-design-of-web-apis>на Manning</a></li></ul></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2021 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>