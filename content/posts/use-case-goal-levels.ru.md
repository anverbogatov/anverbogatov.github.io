+++
title = "Уровни детализации Use Case'ов"
date = "2021-10-19T10:36:26+04:00"
author = "Анвер Богатов"
cover = "https://images.unsplash.com/photo-1550592704-6c76defa9985?ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTJ8fHdyaXRpbmd8ZW58MHx8MHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=1000&q=60"
tags = ["design", "usecase"]
keywords = ["design", "usecase", "business", "goals", "scenarios"]
description = "В этой статье речь пойдёт о прецедентах, сценариях и о способах их детализации. Для рядового разработчика эта тема вряд ли станет интересной. Однако, за кажущейся простой скрывается целый пласт знаний, который будет полезен и в руководстве командами, и в освоении DDD (Domain Driven Design)."
showFullContent = false
+++

### Введение

Для того, чтобы разобраться с темой, нам понадобятся два понятия:

**СЦЕНАРИЙ** - это **последовательность шагов**, совершаемых в определённых условиях, с целью достижения определённой цели, и, оканчивающаяся результатом, который напрямую связан с целью. Эта последовательность начинается с действия, которое является триггером (причиной для начала), и продолжается до тех пор, пока не будет достигнута или провалена конечная цель.

**ПРЕЦЕДЕНТ** - это **набор сценариев** взаимодействия между системой и актёрами; отображает как именно цель основного актёра может быть достигнута или провалена. Например, прецедент оформления возмещения страховой выплаты в результате происшествия, будет включать в себя оба сценария - «успешная выплата» и «выплата невозможна из-за нарушения правил».

Если быть совсем точным, то в состав одного ПРЕЦЕДЕНТА, могут войти один и более СЦЕНАРИЕВ. 

СЦЕНАРИИ, в свою очередь, могут быть двух видов:
* Основными и
* Альтернативными

Основной СЦЕНАРИЙ - это сценарий, описывающий успешное достижение конечной цели главным актёром.

Альтернативный СЦЕНАРИЙ - это сценарий, описывающий безуспешное достижение конечной цели главынм актёром, или же последовательность шагов, позволяющую достичь своей цели, после её провала. 

![use-case-mind-map](/images/use-case-goal-levels/1.png)

#### Примеры

Скорее всего, описание Вам покажется неясным. Особенно, описание Альтернативного СЦЕНАРИЯ, однако, всё встанет на свои места, как только мы разберёмся с примером.

Представьте, что мы составляем ПРЕЦЕДЕНТ, в котором Клиент (основной актёр) резервирует столики в системе обслуживания ресторана. Примером **основного СЦЕНАРИЯ**, в таком случае может быть следующий сценарий:
1. Клиент звонит в ресторан и просит зарезервировать столик на двоих на конкретную дату и время
2. Администратор проверяет наличие столика и подтверждает резерв

В этом случае, цель пользователя достигнута полностью - клиент получил столик в распоряжение в оговорённое время. 

**Альтернативный СЦЕНАРИЙ**, в котором **цель** основного актёра будет **провалена**, может выглядеть следующим образом:
1. Клиент звонит в ресторан и просит зарезервировать столик на двоих на конкретную дату и время
2. Администратор проверяет наличие столика и сообщает Клиенту о том, что в наличии свободного столика на оговорённую дату не имеется

Ну и наконец, **альтернативный СЦЕНАРИЙ**, в котором **цель** основного актёра будет **достигнута после** её первоначального **провала** будет выглядеть так:
1. Клиент звонит в ресторан и просит зарезервировать столик на двоих на конкретную дату и время
2. Администратор проверяет наличие столика и сообщает Клиенту о том, что в наличии свободного столика на оговорённую дату не имеется
3. Администратор проверяет наличие столика на время ближайшее к оговорённому ранее и предлагает эту дату и время Клиенту
4. Клиент подтверждает своё согласие на новую дату и время
5. Администратор подтверждает резерв

### Уровни детализации

В своей работе под названием "Structuring Use cases with goals", Алистер Кокбёрн, вводит понятие уровня моря, как "золотое сечение" степени детализации ПРЕЦЕДЕНТА и СЦЕНАРИЯ. Переводится это буквально - sea level (на следующем изображении, он подписан как "User Goal Level").

![use-case-granularity](/images/use-case-goal-levels/2.png)

Если внимательно посмотреть на изображение выше, можно увидеть, три больших уровня. На двух из них, существуют подуровни. Перечислим их:
* **Summary Level** - можно перевести как "Уровень обобщения". Он имеет два подуровня:
	* Cloud Level - буквально - "Уровень небес"
	* Kite Level - "Уровень кайта". Аналогии с предметами из жизни в данной модели приведены неспроста. Запущенный в небо кайт, летает ниже уровня облаков.
* **Sea Level** (User Goal Level) - "Уровень моря".
* **Subfunctions Level**
	* Fish / Indigo Level
	* Clam / Black Level

Давайте поговорим о каждом из них.

#### Summary Level
Summary Level или Уровень обобщения - это уровень на котором процессы видны в контексте их жизненного цикла. Что это значит, это значит что уровень деталей настолько мал, что мы можем изображать процесс, который в жизни занимает многие дни и даже годы. Каждый шаг на данном уровне имеют свою уникальную конечную цель и может быть представлен в деталях на Уровне моря. 

Кокбёрн выделяет два подуровня на Уровне обобщения:

##### Cloud Level
Уровень небес отображает процессы с наименьшим количеством деталей. ПРЕЦЕДЕНТОВ, описываемых на данном уровне может быть крайне мало, буквально, 5-6 на всю организацию. Примерами могут быть: реклама товаров, продажа товаров потребителям, управление ресурсами и т.д.

##### Kite Level
Уровень кайта показывает обобщённые ПРЕЦЕДЕНТЫ. Сами же ПРЕЦЕДЕНТЫ на этом уровне изображаются на уровне департаментов, но продолжают отображать обобщённые цели. Примерами могут быть: регистрация пассажира на рейс, оформление билета на рейс. 

#### Sea Level (User Goal Level)
На Уровне моря бизнес-процессы описываются уже более детализированно, чем на уровнях выше. Сам Кокбёрн рекомендует задавать следующие вопросы при разработке ПРЕЦЕДЕНТОВ и их СЦЕНАРИЕВ с этим уровнем детализации - "Может ли основной актёр уйти удовлетворённым после выполнения этого процесса? Достиг ли основной актёр своей конечной цели?". Примерами могут быть: добавление товара в корзину, оформление заказа и т.д.

Всё, что проектируется с уровнем детализации ниже Уровня моря скорее относится к системному дизайну, нежели к бизнес проектированию.

#### Subfunctions Level
Ниже Уровня моря лежат мелкие детали. Зачастую, люди из бизнеса не слишком заинтересованы в подобной детализации процессов, однако, людям из разработки подобный уровень детализации позволяет получить больше информации о технических аспектах реализации процесса. 

Кокбёрн выделяет следующие два под уровня:

##### Fish / Indigo Level
Примерами могут быть: поиск кода аэропорта определённого города, отображение списка клиентов, после ввода имени и т.д.

##### Clam / Black Level
Это самый низкий уровень с наибольшим количеством деталей. Подобная детализация может оказаться излишней даже для людей из разработки. Примерами могут быть: валидация введённых в поле данных, добавление нового поля в форму и т.д.

### Пример с картой
Нужны ли все эти уровне в описании бизнес-процессов? Думаю, что нет. Однако, здорово иметь подобную свободу, ведь, каждый может выбрать способ описания ПРЕЦЕДЕНТОВ и СЦЕНАРИЕВ, подходящий конкретно ему.

В любом случае, если после описания выше Вам всё ещё затруднительно разобраться, что это всё означает, я приведу пример с картой, который напрямую отображает некоторые уровни детализации.

Итак, предположим, что у нас есть ПРЕЦЕДЕНТ - "Добраться из Самары в Москву". Процесс перемещения из одного города в другой можно описать разными предложениями, с указанием разных деталей. Визуально, маршрут легко представить с помощью карты:

![use-case-granularity-in-map](/images/use-case-goal-levels/3.jpg)

Как не сложно догадаться, все три картинки, отображают части маршрута от Самары до Москвы с разным удалением от уровня земли. Чем ближе к поверхности земли, тем больше деталей нам доступно. 

**Карта #1** показывает весь маршрут с высоты Уровня небес. Глядя на маршрут с такой высоты мы можем описать его только фразами вида: "Выезжаем из Самарской области в сторону Пензы. Проезжаем Пензу и направляемся в сторону Рязани". В жизни, перемещения на такие расстояния займут много часов. 

**Карта #2** показывает участок маршрута на Уровне моря. Карта на этом уровне детализации содержит большее количество деталей. Маршрут на таком уровне детализации может быть описан примерно такими СЦЕНАРИЯМИ: "Выезжаем через северный выезд из города Самара и едем через посёлок Пребрежный в сторону Жигулёвска". То есть, уровень детализации такой, что мы описываем перемещение между городами и сёлами в пределах одной области. Напомню, в случае с Уровнем небес, мы описывали перемещения между областями и большими городами.

**Карта #3** уже находится на Уровне Рыб (fish level), а значит содержит множество мелких деталей о маршруте. Если взглянуть на карту, можно увидеть маршрут с высокой детализацией - можно рассмотреть по каким именно улицам и дорогам нужно двигаться, где именно поворачивать, и т.д.


### Сферы применения
Напоследок, хочется порассуждать, а где же эти знания могут пригодиться? 

Действительно, разработчики в своей ежедневной практике практически не сталкиваются с разработкой ПРЕЦЕДЕНТОВ и бизнес требований, однако, всё же, это не значит, что навыки описания ПРЕЦЕДЕНТОВ с нужным уровнем детализации будут бесполезны.

На мой взгляд, есть две сферы применения этих навыков в жизни разработчика:
1. Это разработка и управление командой. В случае с разработкой, эти навыки позволяют правильно воспринимать требования их ПРЕЦЕДЕНТОВ, переданных в разработку. Сопоставляя конечную цель основного актёра и СЦЕНАРИИ, входящие в состав ПРЕЦЕДЕНТОВ, разработчик может как лучше понять детали будущей реализации системы, так и увидеть белые пятна в предложенных СЦЕНАРИЯХ (недостаток деталей).
2. Это проектирование. Такие подходы к проектированию, как Domain Storytelling сильно завязаны на понятия СЦЕНАРИЯ и уровней детализации. Наличие навыка составления граммотных ПРЕЦЕДЕНТОВ и СЦЕНАРИЕВ играет ключевую роль в проектировании domain stories в подходе.

### Словарь терминов
* **СЦЕНАРИЙ** - он же scenario, он же user story.
* **ПРЕЦЕДЕНТ** - он же use case или сценарий использования.

### Дополнительные материалы
* [1] Книга Алистера Кокбёрна "Writing Effective Use Cases" https://www.ozon.ru/product/writing-effective-use-cases-1829617/?sh=jD1ziFN8
* [2] Методичка Алистера Кокбёрна "Structuring Use cases with goals" https://www.researchgate.net/publication/2807676_Structuring_Use_cases_with_goals
* [3] Статья "Use Case Modelling" https://www.w3computing.com/systemsanalysis/use-case-modeling/