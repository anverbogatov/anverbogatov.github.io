+++
title = "How to design REST API?"
date = "2021-10-03T18:55:34+04:00"
author = "Anver Bogatov"
authorTwitter = "" #do not include @
cover = "https://miro.medium.com/max/10944/0*7Uc8p5VVguHJA6GU"
tags = ["design", "restapi"]
keywords = ["api", "design", "restapi"]
description = "The article explains in a very easy and accessible manner simple and what is more important working way to design new REST API for applications."
showFullContent = false
+++

# What is API?

**API or Application Programming Interface** — is a description of communication between two programs.
To be even more precise, API is a set of classes, interfaces or data structures which are defined by program that owns the API.
With the API you can make program do something. What exactly - defined by API.

**There are many APIs exist**.
For example, Java itself gives access to dozens of APIs to developers - Core API, Concurrency API, Collection API and many more.
Other frameworks define own APIs - Hibernate API, JPA (Java Persistence API), RestEasy and so on.

**Each of the APIs have own goal**.
APIs are not created just for fun. Each of the API is like a TV remote control. It gives opportunity to control the application.
For example, application for disk space usage analysis can contain API that allow getting statistics on files and space they took; will point to the heaviest file on disk drive and so on.
In the same time, API does not allow doing any random stuff. All capabilities of the API are consistent with it's goal. 

**APIs do not belong to concrete technology**.
If application is written in Java that does not mean that the API will be limited to that particular programming language. Applications can communicate through APIs written using different technologies and programming languages.
For example, REST API.

# What is REST API?

REST or Representational State Transfer is architectural approach based on HTTP protocol.

# Why you need to design REST API?

**Построение программ — это игра в конструктор без жёстких правил**. Победить в этой игре могут все. Но настоящее искусство программиста это написание таких программ, которые будут работать быстро, безотказно и легко расширяться. Поэтому, как и при стройке дома, важно знать заранее что и как будет построено, ибо цена ошибки на этапе проектирование ниже, чем цена ошибки в момент, когда дом уже готов.

# Предметно-ориентированное проектирование REST API

**Техника, которой я сегодня поделюсь** хорошо описана в книге издательства Manning — “The Design of Web APIs" [2]. Ссылку на книгу можно найти в конце статьи.

**Небольшая вводная**, прежде чем мы приступим к рассмотрению методики. Все идеи и советы ниже крайне ориентированы на практику. Это не теоретические знания, это живой метод проектирования REST API, поэтому и разбирать мы его будем на живом примере. Представьте, что Нам нужно спроектировать REST API для блог-сервиса. Конкретно, Мы отвечаем за работу с постами и их комментариями. На примере этого требования мы и разберёмся с методом.

**Какие цели могут быть у такого API?** Пожалуй их будет несколько:
* Прочитать имеющиеся посты. Должен быть способ получить список уже имеющихся постов.
* Изменение имеющегося поста. Что если в текст прокралась ошибка? Автор должен иметь возможность её поправить после написания и публикации поста.
* Создание нового поста. Как-то же пост попадает наш блогосервис.
* Удаление поста. Автор решил удалить свой устаревший пост или пост с идеями, в которые он больше не верит.
* Чтение комментариев к посту. Для краткости предположим что комментарии попадают в наш блогосервис каким-то иным способом, не через наше REST API. Однако, в нашем REST API мы хотим разрешить пользователям читать комментарии для имеющихся постов.

Эти цели мы транслируем в REST API.

**Теперь разберёмся с основными правилами**:
* Цели транслируются в **ресурсы** и **действия**
* **Ресурсы** определяются путём в REST API, а **действия** определяются методами HTTP

**Что такое ресурс?** Ресурс это объект, представление, сущность, всё что угодно, что представляет данные в системе. В нашем блогосервисе ресурсов несколько — Пост и Комментарий.

**Что такое действие?** Действие это способ заставить наш блогосервис что-то сделать, например — отдать список имеющихся постов, создать новый и так далее. Действия определяются методами HTTP протокола, как уже было сказано выше. Таких действий несколько, но нас интересуют стандартные: GET, POST, PUT, DELETE.

**Перейдём к самому проектированию**. Разберём его по шагам:
* Перво-наперво нужно определить все ресурсы и под-ресурсы, с которыми наше API должно работать. В нашем случае это **Пост** и **Комментарий**.
* Далее, нужно определить набор действий, которые наше API позволяет совершать над ресурсами. Для нас это:
1) GET Пост — для получения списка имеющихся постов
2) POST Пост — для создания нового поста
3) PUT Пост — для изменения имеющегося поста
4) DELETE Пост — для удаления поста
5) GET Комментарий — для получения списка комментариев поста

* Определим набор параметров для действий, которые мы спроектировали выше:
1) Операция получения постов GET — может быть вызвана как без параметров, что приведёт к чтению всех имеющихся постов, так и с идентификатором конкретного поста для получения выбранного поста
2) Операция создания поста POST подразумевает, что в неё будет передана информация о посте, который необходимо создать
3) PUT требует двух параметров — идентификатора поста, который мы будем изменять и сам пост, который заменит имеющийся в блогосервисе
4) DELETE требует идентификатора поста, который необходимо удалить
5) Операция получения комментариев GET требует идентификатора поста, потому что мы хотим получить список комментариев к определённому посту

**Прервёмся на секунду**. Мы провели большую подготовительную работу для сбора данных о нашем будущем API. Теперь мы знаем как конкретно и с чем конкретно наше API будет работать. Но эту информацию стоит дополнить и на следующем шаге мы займёмся именно этим.

На какие ещё моменты нам стоит обратить внимание? Их несколько. Нужно ответить на следующие вопросы:
* Кто будет вызывать операции API?
* Что и как будет делать этот кто-то с нашим API?

**Небольшая ремарка** — структура статьи на Medium не позволяет создать таблицу, хотя дальнейшую работу по проектированию нашего REST API я рекомендую проводить именно с таблицами. Поэтому дальше — мы в текстовом виде разберём что нам нужно делать, но я подразумеваю, что все моменты которые мы оговорим будут внесены в специальную таблицу.

**Наша таблица проектирования — наш помощник**. Список её колонок следующий:
* **Кто** — тут могут быть роли пользователей, которые будут работать с нашим API
* **Что** — имеется ввиду что делает пользователь с нашим API. Его ожидания
* **Как** — опять же, как наш пользователь достигает своей цели
* **Входные данные** — информацию, которую необходимо передать нашему API, для того, чтобы оно помогло пользователю достигнуть цели
* **Выходные данные** — информация, которую вернёт наш API в результате работы метода
* **Цель** — описывает явно смысл конкретной операции нашего API
* **HTTP метод** — указание на HTTP метод, который описывает действие нашего пользователя
* **URI** — путь по которому данная операция нашего API доступна клиентам

![design-rest-api-table-1](/images/design-rest-api/1.png)

**Всё что нам осталось сделать**, это на основе информации, которую мы проговорили выше **заполнить эту табличку**. Попробуем сделать это для операции получения постов:

![design-rest-api-table-2](/images/design-rest-api/2.png)

**Разберём подробнее**. Раз уж мы работаем с постами, то кто-то их должен писать. Это будет Автор. Автор может получить доступ ко всем своим постам, поэтому для операции чтения постов нам не требуется никаких входных данных. Реализация самого API может установить текущего пользователя системы и определить авторство постов. На выходе же мы получим список постов, которые были написаны автором (или текущем залогиненным пользователем). Операция получения данных описывается в HTTP протоколе методом GET, а URI в конце, может иметь произвольную структуру, но общепринято в хвосте URL путь писать с указанием ресурса с которым в данном API мы работаем во множественном числе. В нашем случае это `…/posts`.

**По мере заполнения таблицы, всегда задаём себе вопросы** — откуда берутся ресурсы, кто с ними работает и так далее. Чем шире посмотреть на имеющиеся данные, тем больше возможных кейсов можно идентифицировать на этапе проектирования. Простой пример — мы спроектировали операцию получения авторских постов. Но кто эти посты добавляет в систему? Очевидно, что авторы. Спроектируем и это:

![design-rest-api-table-3](/images/design-rest-api/3.png)

Пользуясь этим подходом **спроектируем оставшиеся операции**:

![design-rest-api-table-4](/images/design-rest-api/4.png)

**Обратите внимание на последнюю строку**. Мы уже коснулись темы подресурсов выше. В таблице на картинке выше Вы можете заметить как выглядит URI для доступа к комментариям поста. В пути сначала пишется родительский ресурс, а потом уже указание на подресурс: `/api/[resource]/{id}/[sub-resource]`. Это общепринятая практика и подобное построение пути даёт возможность пользователям Вашего API сразу понять какие ресурсы зависят от других.

**В заключение, хочется задать вопрос — Подходит ли спроектированное нами API на все случаи жизни? Конечно же — нет**. Если Вы присмотритесь к таблице внимательнее, станет ясно, что это API предназначено исключительно для Авторов постов. Автор может читать только свои посты. А вот пользователи блогосервиса должны получать доступ ко всем постам всех авторов. Такие вот моменты становятся видны, если на этапе проектирования каждой из операции задавать вопросы о том, кто будет пользоваться ими и в каких случаях.

**Надеюсь эта статья поможет Вам** подступиться к такой огромной теме как REST API’и и направит Вас в моменты, когда придётся проектировать собственное API.

# Полезные ссылки
* [1] Мой старый [блог на Medium](https://anver-bogatov.medium.com/как-проектировать-rest-api-86b2d6737401)
* [2] Книга "The Design of Web APIs" [на Manning](https://www.manning.com/books/the-design-of-web-apis)