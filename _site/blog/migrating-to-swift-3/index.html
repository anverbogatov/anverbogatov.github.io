<!DOCTYPE html>
<html lang="en">
   <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-control" content="public">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="keywords" content="hexed bits, apps, iOS, objective-c, swift, cocoa, apple, xcode, app store, software, programming, engineering, design patterns">
    <meta name="description" content="–ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å - –Ω–µ –ø—Ä–µ–¥–µ–ª.">
    <meta name="author" content="Anver Bogatov">

    <title>
        
            Migrating to Swift 3 &middot; Anver Bogatov
        
    </title>

    <!-- Begin Jekyll SEO tag v2.2.3 -->
<meta property="og:title" content="Migrating to Swift 3" />
<meta name="author" content="Anver Bogatov" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I spent most of my free time last weekend and a few days of last week on migrating my Swift code to Swift 3.0 ‚Äî I migrated my open source projects as well as my private side projects. Overall, I would say my experience was ‚ÄúOK‚Äù. It definitely could have been better, but I think the largest problem was overcoming the cognitive hurdle of seeing all the changes and errors from Xcode‚Äôs migration tool at once. The best thing to do is wipe away the tears, put your headphones on, and start hacking. ü§ì" />
<meta property="og:description" content="I spent most of my free time last weekend and a few days of last week on migrating my Swift code to Swift 3.0 ‚Äî I migrated my open source projects as well as my private side projects. Overall, I would say my experience was ‚ÄúOK‚Äù. It definitely could have been better, but I think the largest problem was overcoming the cognitive hurdle of seeing all the changes and errors from Xcode‚Äôs migration tool at once. The best thing to do is wipe away the tears, put your headphones on, and start hacking. ü§ì" />
<link rel="canonical" href="http://localhost:4000/blog/migrating-to-swift-3/" />
<meta property="og:url" content="http://localhost:4000/blog/migrating-to-swift-3/" />
<meta property="og:site_name" content="Anver Bogatov" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-07-25T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@anver_bogatov" />
<meta name="twitter:creator" content="@anver_bogatov" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Migrating to Swift 3","author":{"@type":"Person","name":"Anver Bogatov"},"datePublished":"2016-07-25T00:00:00+00:00","dateModified":"2016-07-25T00:00:00+00:00","description":"I spent most of my free time last weekend and a few days of last week on migrating my Swift code to Swift 3.0 ‚Äî I migrated my open source projects as well as my private side projects. Overall, I would say my experience was ‚ÄúOK‚Äù. It definitely could have been better, but I think the largest problem was overcoming the cognitive hurdle of seeing all the changes and errors from Xcode‚Äôs migration tool at once. The best thing to do is wipe away the tears, put your headphones on, and start hacking. ü§ì","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/img/logo.png"},"name":"Anver Bogatov"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/migrating-to-swift-3/"},"url":"http://localhost:4000/blog/migrating-to-swift-3/"}</script>
<!-- End Jekyll SEO tag -->


    <meta name="twitter:image" content="/img/logo.png" />
    <meta property="og:image" content="/img/logo.png" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="512" />
    <meta property="og:image:height" content="512" />

    <link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/bower_components/ubuntuMono/ubuntuMono.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="/bower_components/html5shiv/dist/html5shiv.min.js"></script>
      <script src="/bower_components/respond/dest/respond.min.js"></script>
    <![endif]-->

    <link rel="apple-touch-icon" sizes="76x76" href="/ico/icon76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/ico/icon120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/ico/icon152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/ico/icon167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/ico/icon180.png">

    <link rel="shortcut icon" href="/favicon.ico">
    <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Anver Bogatov" />

    <script>
         (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
         ga('create', 'UA-37319916-5', 'auto');
         ga('send', 'pageview');
    </script>
</head>

   <body>
      
<header class="container container-fluid">
   <div class="row">
      <div class="col-md-12 col-sm-12 col-xs-12">
        <h1 class="text-center"><a href="/">Anver Bogatov</a></h1>
        <div class="col-md-12 col-sm-12 col-xs-12">
            <h2 class="tagline">&mdash; –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å - –Ω–µ –ø—Ä–µ–¥–µ–ª. &mdash;</h2>
         </div> <!-- col -->
      </div> <!-- col -->
   </div> <!-- row -->

   <div class="row menu">
      <div class="col-md-12 col-sm-12 col-xs-12">
         <a class="btn btn-default" href="/">–ë–ª–æ–≥</a>
         <!-- <a class="btn btn-default" href="/speaking/">Speaking</a> -->
         <a class="btn btn-default" href="/about/">–û–±–æ –º–Ω–µ</a>
      </div> <!-- col -->
   </div> <!-- row -->
   <hr>
</header>


      <div class="container container-fluid">
         <div class="row">
            <div class="col-sm-12 col-sm-offset-0 col-md-10 col-md-offset-1">
               <article>
   <h1 class="post-title"><a href="">Migrating to Swift 3</a></h1>
   <h2 class="post-subtitle">Advice, tips, and warnings <small class="post-date">25 Jul 2016</small></h2>
   

   <div class="post-content">
      <p>I spent most of my free time last weekend and a few days of last week on migrating my Swift code to Swift 3.0 ‚Äî I migrated my open source projects as well as my private side projects. Overall, I would say my experience was ‚ÄúOK‚Äù. It definitely could have been better, but I think the largest problem was overcoming the cognitive hurdle of seeing all the changes and errors from Xcode‚Äôs migration tool at once. The best thing to do is wipe away the tears, put your headphones on, and start hacking. ü§ì</p>

<!--excerpt-->

<p><img class="img-thumbnail img-responsive center" src="/img/eidhof-programmer.jpg" title="A Swift programmer" alt="A Swift programmer" />
<small class="text-muted center">A real-life Swift programmer, ready for migration. Photo taken just before migrating to Swift 3.0. (<a href="http://www.itworld.com/article/2892928/music-to-get-you-into-the-coding-groove.html">Source</a>)</small></p>

<h3 id="open-source-migration-strategy">Open source migration strategy</h3>

<p>Here‚Äôs my basic git workflow for migrating my open source libraries:</p>

<ol>
  <li>All normal development happens on the <code class="highlighter-rouge">develop</code> branch</li>
  <li>Create a <code class="highlighter-rouge">swift2.3</code> branch from <code class="highlighter-rouge">develop</code> and run Xcode‚Äôs migrator for Swift 2.3</li>
  <li>Create a <code class="highlighter-rouge">swift3.0</code> branch <strong>from the <code class="highlighter-rouge">swift2.3</code> branch</strong> and run Xcode‚Äôs migrator for Swift 3.0</li>
</ol>

<p>This creates the following model:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">o-----o develop <span class="o">(</span>swift 2.2<span class="o">)</span>
       <span class="se">\</span>
        o-----o swift2.3
               <span class="se">\</span>
                o-----o swift3.0</code></pre></figure>

<p>My plan for now is to keep these branches in sync like what you see above. That is, <code class="highlighter-rouge">swift2.3</code> will be ahead of <code class="highlighter-rouge">develop</code> and <code class="highlighter-rouge">swift3.0</code> will be ahead of <code class="highlighter-rouge">swift2.3</code>. The end goal will be to merge changes from each branch back into a single squashed commit on <code class="highlighter-rouge">develop</code> when the final release of Xcode 8 is out.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">                           merge 2.3           merge 3.0
o------o                    o                    o-----------o develop
        <span class="se">\ </span>                 /                    /
         o--- swift2.3 ---o                    /
                           <span class="se">\ </span>                 /
                            o--- swift3.0 ---o</code></pre></figure>

<p>Each merge into <code class="highlighter-rouge">develop</code> will be a major release of the library. For example, if the library is currently at <code class="highlighter-rouge">v2.0</code>, then the Swift 2.3 merge will result in <code class="highlighter-rouge">v3.0</code> of the library and the Swift 3.0 merge will result in <code class="highlighter-rouge">v4.0</code> of the library. This ensures <a href="http://semver.org">semantic versioning</a> and allows clients to safely migrate between versions <em>at their own pace</em> as they adopt the next version of Swift.</p>

<h3 id="private-projects">Private projects</h3>

<p>For my private projects, I migrated directly to Swift 3.0. I use <a href="https://cocoapods.org">CocoaPods</a>, so I migrated my dependencies first. This means following the steps above for each open source library (or private pod).</p>

<p>So far, the only dependencies I have for this project are my own libraries, which made this quite easy since I control all of the code. However, if you have third-party dependencies, then I would recommend opening an issue on the project to discuss migration plans with the current maintainers. I expect most popular projects are doing something similar to what I described above. For example, <a href="https://github.com/Alamofire/Alamofire">AlamoFire</a> has a <code class="highlighter-rouge">swift2.3</code> and <code class="highlighter-rouge">swift3.0</code> branch. If needed, you can fork and migrate third-party libraries yourself ‚Äî then submit a pull request or use your fork until the maintainers offer a solution. However, you should definitely reach out to project maintainers before submitting a pull request for migration.</p>

<p>Until Xcode 8 is final, you‚Äôll need to point your pods to these new branches:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">pod</span> <span class="s1">'MyLibrary'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'https://github.com/username/MyLibrary.git'</span><span class="p">,</span> <span class="ss">:branch</span> <span class="o">=&gt;</span> <span class="s1">'swift3.0'</span></code></pre></figure>

<p>This tells CocoaPods to fetch the latest on the <code class="highlighter-rouge">swift3.0</code> branch, instead of the latest published version.</p>

<p>Once your dependencies and <code class="highlighter-rouge">Podfile</code> are updated, you can run <code class="highlighter-rouge">pod update</code> to bring in the Swift 3.0 versions of each library. <em>Then</em> you can migrate your main app. I suggest commiting all of this migration in a single commit ‚Äî update all dependencies, migrate your app, then commit ‚Äî to keep your history clean.</p>

<h3 id="tips">Tips</h3>

<p>These things probably go without saying, but it doesn‚Äôt hurt to reiterate.</p>

<ol>
  <li>Make sure you have decent test coverage on the code you are migrating. The changes are <strong>massive</strong> and having a list of green checkmarks once the migration is over is the best way to ensure you haven‚Äôt broken anything. ‚úÖ</li>
  <li>Resist doing any other refactoring during the migration. Migrate, commit, <strong>then</strong> make <em>Swifty API</em> changes in a follow-up commit to bring your code up-to-date with the latest <a href="https://swift.org/documentation/api-design-guidelines/">API guidelines</a>.</li>
  <li>If you haven‚Äôt migrated yet, wait until <em>right after</em> the next beta. I made the mistake of migrating during beta 2 after it had been out for two weeks. The next day, beta 3 was released. üòÖ The changes between the betas weren‚Äôt as large as the initial migration, but they weren‚Äôt trivial either ‚Äî <strike>and the migrator doesn't work between betas, so you have to apply each Xcode fix-it individually.</strike> <strong>Update: <a href="https://twitter.com/clattner_llvm/status/757626936810057728">the migrator does work between betas</a>, but you have to run it manually. (I thought I tried this, but I might be mistaken.)</strong> I would rather have waited the extra day to migrate all at once with beta 3, then tackle the changes in beta 4 two weeks later.</li>
  <li><strong>Do not</strong> migrate everything in a single day. Accept that this is a multi-day task. I did one or two libraries in a day and then spent a few days migrating the full app. Commit or <code class="highlighter-rouge">git stash</code> a work-in-progress and resume the next day.</li>
  <li>When in doubt about how to properly migrate a piece of code, consult the new swift-evolution <a href="http://apple.github.io/swift-evolution/">proposal status page</a> to find the corresponding proposal. In the <em>Implemented for Swift 3</em> section, you‚Äôll find all of the proposals that have been implemented for Swift 3. Note that not all of these may be in the current beta yet.</li>
</ol>

<h3 id="bugs">Bugs</h3>

<p>Xcode‚Äôs migration tool is not perfect. üò± It would sometimes fail to migrate test targets, or only partially migrate app and framework targets. When this happens, you can attempt to run the tool again, but it‚Äôs probably best to make changes manually. Here are some of the specific issues that I saw:</p>

<ul>
  <li>Some expressions inside of <code class="highlighter-rouge">XCTAssert*()</code> did not migrate.</li>
  <li>Some expressions inside closures did not migrate.</li>
  <li>Sometimes <code class="highlighter-rouge">waitForExpectations(timeout:)</code> did not migrate.</li>
  <li>Migrating <code class="highlighter-rouge">NSIndexPath</code> to <code class="highlighter-rouge">IndexPath</code> when used in certain contexts often resulted in derpy things like <code class="highlighter-rouge">(indexPath as! NSIndexPath).section</code>.</li>
  <li>Enums with associated <code class="highlighter-rouge">NSDate</code> values migrated to <code class="highlighter-rouge">case myCase(Foundation.Date)</code> instead of <code class="highlighter-rouge">case myCase(Date)</code>.</li>
  <li>Sometimes <code class="highlighter-rouge">optional</code> protocol methods did not migrate, which can produce hard-to-find bugs.</li>
</ul>

<h3 id="conclusion">Conclusion</h3>

<p>Migrating Swift code is as fun as fixing your CI servers for the <em>Nth</em> time and as exciting as waiting for an hours-long test suite to run on your local machine. Even <a href="https://xkcd.com/303/">waiting for your code to compile</a> is probably more fun than migrating to Swift 3. üòÑ When you first see all the changes and errors that the migrator produces, it will be cognitive overload. It‚Äôs a lot to absorb at once. You can always find comfort in <code class="highlighter-rouge">git reset --HARD</code>, but you will have to migrate eventually. And when you finish, you‚Äôll feel great.</p>

<p><em>This weekend</em> I got to spend my time writing Swift 3.0 code ‚Äî not migrating it ‚Äî and it was awesome.</p>

   </div> <!-- post-content -->
</article>


<div class="post-share-subscribe">
   <div class="row">
      <div class="col-md-6 col-sm-6 col-xs-12 center">
         <div class="btn-group btn-group-justified" role="group">

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Share &nbsp;<i class="fa fa-share-alt" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li>
                     <a href="https://twitter.com/intent/tweet?text=Migrating%20to%20Swift%203%20http://localhost:4000/blog/migrating-to-swift-3/%20via%20@anver_bogatov" title="Tweet" target="_blank">
                     Twitter &nbsp;<i class="fa fa-twitter" aria-hidden="true"></i>
                     </a>
                  </li>
                  <li>
                     <a href="https://www.facebook.com/sharer.php?u=http://localhost:4000/blog/migrating-to-swift-3/" title="Post" target="_blank">
                     Facebook &nbsp;<i class="fa fa-facebook" aria-hidden="true"></i>
                     </a>
                  </li>
                  <li>
                     <a href="https://plus.google.com/share?url=http://localhost:4000/blog/migrating-to-swift-3/" title="Share" target="_blank">
                     Google &nbsp;<i class="fa fa-google-plus" aria-hidden="true"></i>
                     </a>
                  </li>
               </ul>
            </div> <!-- share dropup -->

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Subscribe &nbsp;<i class="fa fa-rss" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li><a href="/feed.xml" title="Subscribe via RSS/atom">RSS/Atom &nbsp;<i class="fa fa-rss" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Add to Apple News">Apple News &nbsp;<i class="fa fa-apple" aria-hidden="true"></i></a></li>
               </ul>
            </div> <!-- subscribe drop-up -->

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Support &nbsp;<i class="fa fa-star" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li><a href="" title="Donate via PayPal" target="_blank">Donate via PayPal &nbsp;<i class="fa fa-paypal" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Donate via Square Cash" target="_blank">Donate via Square &nbsp;<i class="fa fa-dollar" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Donate Bitcoin" target="_blank">Donate Bitcoin &nbsp;<i class="fa fa-btc" aria-hidden="true"></i></a></li>
               </ul>
            </div> <!-- donate drop-up -->

         </div> <!-- btn-group -->
      </div> <!-- col -->
   </div> <!-- row -->

   <div class="row feedback">
      <div class="col-md-6 col-sm-6 col-xs-12 center">
         <p class="text-muted text-center"><small><b>Questions? Feedback? Corrections?</b></small></p>
         <p class="text-muted text-center"><small>
         Open an <a href="https://github.com/anverbogatov/anverbogatov.github.io/issues/new" target="_blank">issue</a> or
         submit a <a href="https://github.com/anverbogatov/anverbogatov.github.io/compare" target="_blank">pull request</a>.
         </small></p>
      </div> <!-- col -->
   </div> <!-- row -->

</div> <!-- post-share-subscribe -->


            </div> <!-- col -->
         </div> <!-- row -->
      </div> <!-- container -->

      
<footer class="container container-fluid">
   <hr>

   <div class="row contact">
    <div class="col-sm-12 col-sm-offset-0 col-md-8 col-md-offset-2">
        <ul class="inline center">
            <li><a href="https://github.com/anverbogatov" title="Follow me on Github"><i class="fa fa-2x fa-github" aria-hidden="true"></i></a></li>
            <li><a href="https://twitter.com/anver_bogatov" title="Follow me on Twitter"><i class="fa fa-2x fa-twitter" aria-hidden="true"></i></a></li>
            <li><a href="https://www.linkedin.com/in/anver-bogatov-64b32661/" title="Connect with me on LinkedIn"><i class="fa fa-2x fa-linkedin" aria-hidden="true"></i></a></li>
            <li><a href="/feed.xml" title="Subscribe via RSS/atom"><i class="fa fa-2x fa-rss-square" aria-hidden="true"></i></a></li>
            <li><a href="" title="Add to Apple News"><i class="fa fa-2x fa-apple" aria-hidden="true"></i></a></li>
        </ul>
    </div> <!-- col -->
</div> <!-- row -->


   <p class="text-muted text-center"><small>
   &copy; 2017 Anver Bogatov.
   This site is <a href="https://github.com/anverbogatov/anverbogatov.github.io">open source</a>.
   </small></p>
</footer>

      
<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

   </body>
</html>
