<!DOCTYPE html>
<html lang="en">
   <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-control" content="public">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="keywords" content="hexed bits, apps, iOS, objective-c, swift, cocoa, apple, xcode, app store, software, programming, engineering, design patterns">
    <meta name="description" content="–ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å - –Ω–µ –ø—Ä–µ–¥–µ–ª.">
    <meta name="author" content="Anver Bogatov">

    <title>
        
            Thoughts on Swift access control &middot; Anver Bogatov
        
    </title>

    <!-- Begin Jekyll SEO tag v2.2.3 -->
<meta property="og:title" content="Thoughts on Swift access control" />
<meta name="author" content="Anver Bogatov" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="There has been a ton of debate on the swift-evolution mailing lists about access control in Swift. A couple of days ago, the proposal SE-0159: Fix Private Access Levels was rejected. I want to share my thoughts on this, as well as thoughts on the larger story for access control in general. But first, let‚Äôs begin with a brief history of access control in Swift." />
<meta property="og:description" content="There has been a ton of debate on the swift-evolution mailing lists about access control in Swift. A couple of days ago, the proposal SE-0159: Fix Private Access Levels was rejected. I want to share my thoughts on this, as well as thoughts on the larger story for access control in general. But first, let‚Äôs begin with a brief history of access control in Swift." />
<link rel="canonical" href="http://localhost:4000/blog/thoughts-on-swift-access-control/" />
<meta property="og:url" content="http://localhost:4000/blog/thoughts-on-swift-access-control/" />
<meta property="og:site_name" content="Anver Bogatov" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-04-05T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@anver_bogatov" />
<meta name="twitter:creator" content="@anver_bogatov" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Thoughts on Swift access control","author":{"@type":"Person","name":"Anver Bogatov"},"datePublished":"2017-04-05T00:00:00+00:00","dateModified":"2017-04-05T00:00:00+00:00","description":"There has been a ton of debate on the swift-evolution mailing lists about access control in Swift. A couple of days ago, the proposal SE-0159: Fix Private Access Levels was rejected. I want to share my thoughts on this, as well as thoughts on the larger story for access control in general. But first, let‚Äôs begin with a brief history of access control in Swift.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/img/logo.png"},"name":"Anver Bogatov"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/thoughts-on-swift-access-control/"},"url":"http://localhost:4000/blog/thoughts-on-swift-access-control/"}</script>
<!-- End Jekyll SEO tag -->


    <meta name="twitter:image" content="/img/logo.png" />
    <meta property="og:image" content="/img/logo.png" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="512" />
    <meta property="og:image:height" content="512" />

    <link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/bower_components/ubuntuMono/ubuntuMono.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="/bower_components/html5shiv/dist/html5shiv.min.js"></script>
      <script src="/bower_components/respond/dest/respond.min.js"></script>
    <![endif]-->

    <link rel="apple-touch-icon" sizes="76x76" href="/ico/icon76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/ico/icon120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/ico/icon152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/ico/icon167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/ico/icon180.png">

    <link rel="shortcut icon" href="/favicon.ico">
    <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Anver Bogatov" />

    <script>
         (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
         ga('create', 'UA-37319916-5', 'auto');
         ga('send', 'pageview');
    </script>
</head>

   <body>
      
<header class="container container-fluid">
   <div class="row">
      <div class="col-md-12 col-sm-12 col-xs-12">
        <h1 class="text-center"><a href="/">Anver Bogatov</a></h1>
        <div class="col-md-12 col-sm-12 col-xs-12">
            <h2 class="tagline">&mdash; Turing complete with a stack of <code>0xdeadbeef</code>&mdash;</h2>
         </div> <!-- col -->
      </div> <!-- col -->
   </div> <!-- row -->

   <div class="row menu">
      <div class="col-md-12 col-sm-12 col-xs-12">
         <a class="btn btn-default" href="/">Blog</a>
         <a class="btn btn-default" href="/speaking/">Speaking</a>
         <a class="btn btn-default" href="/about/">About</a>
      </div> <!-- col -->
   </div> <!-- row -->
   <hr>
</header>


      <div class="container container-fluid">
         <div class="row">
            <div class="col-sm-12 col-sm-offset-0 col-md-10 col-md-offset-1">
               <article>
   <h1 class="post-title"><a href="">Thoughts on Swift access control</a></h1>
   <h2 class="post-subtitle">And the opportunity costs of Swift evolution <small class="post-date">05 Apr 2017</small></h2>
   

   <div class="post-content">
      <p>There has been a ton of debate on the <a href="https://lists.swift.org/mailman/listinfo/swift-evolution">swift-evolution mailing lists</a> about <a href="https://twitter.com/swiftlybrief/status/846938309666492417">access control</a> in Swift. A couple of days ago, the proposal <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0159-fix-private-access-levels.md">SE-0159</a>: <em>Fix Private Access Levels</em> was <a href="https://lists.swift.org/pipermail/swift-evolution-announce/2017-April/000337.html">rejected</a>. I want to share my thoughts on this, as well as thoughts on the larger story for access control in general. But first, let‚Äôs begin with a brief history of access control in Swift.</p>

<!--excerpt-->

<p>‚ö†Ô∏è Warning: some opinions are forthcoming. üòÑ</p>

<p><img class="img-thumbnail img-responsive center" src="/img/swift-access-control.jpg" title="Swift Access Control" alt="Swift Access Control" /></p>

<h3 id="a-brief-history-of-access-control">A brief history of access control</h3>

<p>In the early days of Swift ‚Äî pre-1.0 ‚Äî there were no access controls. These were the golden days of Swift. Everything was public and globally accessible from anywhere. No one had to think about proper encapsulation. There were no month-long email debates (because swift-evolution didn‚Äôt exist yet). No access controls were the simplest access controls, and no evolution was the best evolution. üòâ</p>

<h4 id="access-control-arrives">Access control arrives</h4>

<p>In Xcode 6 beta 4, Swift added support for <a href="https://developer.apple.com/swift/blog/?id=5">access control</a>. It was easy to understand, easy to use, and quite elegant. Shortly after, <a href="https://developer.apple.com/swift/blog/?id=14">Swift 1.0 was officially released</a> with this access control model. Swift 1.0 was bundled with <a href="https://developer.apple.com/library/content/releasenotes/DeveloperTools/RN-Xcode/Chapters/Introduction.html#//apple_ref/doc/uid/TP40001051-CH1-SW453">Xcode 6</a>. There was no <a href="https://developer.apple.com/swift/blog/?id=11">‚Äúprotected‚Äù access level</a>, which conflates <em>access</em> with <a href="https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)"><em>inheritance</em></a>. There was no <a href="http://www.cplusplus.com/doc/tutorial/inheritance/">‚Äúfriend‚Äù access level</a>, because that‚Äôs just gross. There were only three access levels:</p>

<ul>
  <li><code class="highlighter-rouge">public</code> entities were accessible from any file that imports the module (a framework or library)</li>
  <li><code class="highlighter-rouge">internal</code> (the default) entities were only accessible within their current module (an app or framework target, also think ‚Äúcurrent <em>directory</em>‚Äù √† la <a href="https://github.com/apple/swift-package-manager/tree/master/Documentation#about-modules">Swift Package Manager</a>)</li>
  <li><code class="highlighter-rouge">private</code> entities were only accessible from within the source file where they were defined</li>
</ul>

<p>As a library author and app developer, these access levels provide all the tools necessary for me to express anything I want. Aside from the obvious use cases, one can achieve a ‚Äútraditional‚Äù notion of ‚Äúprivate‚Äù access by simply defining a type or other entities in their own files. For example, if I define <code class="highlighter-rouge">class A</code> and want all of its (<code class="highlighter-rouge">private</code>) properties to be inaccessible by other classes, then I can define <code class="highlighter-rouge">class A</code> in its own file with nothing else. This is what I love about Swift access control ‚Äî it encourages best practices (reducing file bloat and module bloat) by providing access levels that basically reflect the ‚Äúphysical‚Äù structure of files and directories on disk. Designing proper encapsulation means you <em>have to</em> move files into clearly defined modules (directories) and you <em>have to</em> define related types in a single file or completely avoid multiple type definitions in a single file. Code organization and access control are nicely coupled and encourage developers to keep code well-organized. (<a href="https://en.wikipedia.org/wiki/Coupling_(computer_programming)">Coupling</a> is typically <strong>bad</strong> in software design, but in this case the coupling is desirable.)</p>

<h4 id="introducing-fileprivate">Introducing <code class="highlighter-rouge">fileprivate</code></h4>

<p>The next phase began when <a href="https://developer.apple.com/swift/blog/?id=34">Swift was open sourced</a> and the <a href="https://swift.org/contributing/#participating-in-the-swift-evolution-process">Swift Evolution Process</a> was introduced. The proposal <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0025-scoped-access-level.md">SE-0025</a>: <em>Scoped Access Level</em> was <a href="https://lists.swift.org/pipermail/swift-evolution-announce/2016-February/000049.html">reviewed</a>, <a href="https://lists.swift.org/pipermail/swift-evolution-announce/2016-March/000063.html">revised</a>, and finally <a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20160328/014008.html">accepted</a> for Swift 3. This proposal changed the meaning of <code class="highlighter-rouge">private</code> to restrict access to an entity to within the current scope or declaration, and preserved the former meaning with a new keyword, <code class="highlighter-rouge">fileprivate</code>. The hypothesis at the time was that the new (and somewhat intentionally ugly) <code class="highlighter-rouge">fileprivate</code> keyword would rarely be used, thus abiding by Swift‚Äôs design philosophy of <a href="https://en.wikipedia.org/wiki/Progressive_disclosure">progressive disclosure</a>. Little did we know that this would <em>not</em> be true in practice. Another side effect was that cognitive load increased, due to the overloaded term ‚Äúprivate‚Äù and the overlapping functionality of <code class="highlighter-rouge">fileprivate</code> and <code class="highlighter-rouge">private</code>.</p>

<h4 id="out-in-the-open">Out in the <code class="highlighter-rouge">open</code></h4>

<p>A mere <em>three months later</em>, the <a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20160627/022354.html">initial discussions</a> began for another change to access control. After <strong>three</strong> controversial <a href="https://lists.swift.org/pipermail/swift-evolution-announce/2016-July/000249.html">review periods</a> and revisions, proposal <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0117-non-public-subclassable-by-default.md">SE-0117</a>: <em>Allow distinguishing between public access and public overridability</em> was <a href="https://lists.swift.org/pipermail/swift-evolution-announce/2016-July/000268.html">accepted</a> for Swift 3. The proposal introduced a new access level called <code class="highlighter-rouge">open</code> and changed the definition of <code class="highlighter-rouge">public</code> in some contexts. The meaning of <code class="highlighter-rouge">public</code> narrowed regarding subclassing and overriding. A <code class="highlighter-rouge">public</code> class can no longer be subclassed outside of the module in which it is defined and any <code class="highlighter-rouge">public</code> members of a class can no longer be overridden by a subclass outside of the class‚Äôs module. Thus, <code class="highlighter-rouge">open</code> classes are <code class="highlighter-rouge">public</code> and also subclassable and any <code class="highlighter-rouge">open</code> property or function on an <code class="highlighter-rouge">open</code> class is overridable by subclasses. Did you follow that? The rules regarding <code class="highlighter-rouge">public</code> and <code class="highlighter-rouge">open</code> are a labyrinth and are further complicated by <code class="highlighter-rouge">final</code>, which prevents overriding and subclassing. Thus, <code class="highlighter-rouge">final public</code> and <code class="highlighter-rouge">public</code> classes have different semantics depending on whether or not a client is within the same module or outside of it. Again, the cognitive load increased when thinking about access control. This time, the overlapping functionality of <code class="highlighter-rouge">open</code> and <code class="highlighter-rouge">public</code> was even more pronounced and harder to discern.</p>

<p>Despite the complexity of <code class="highlighter-rouge">open</code> and its jungle of rules and edge cases, it abides by the progressive disclosure philosophy extremely well. Many Swift users, especially beginners, may never need to use or know about <code class="highlighter-rouge">open</code>. Only library authors and more advanced users will likely encounter uses for <code class="highlighter-rouge">open</code>. The progressive disclosure of <code class="highlighter-rouge">open</code> is further manifested in Swift‚Äôs design affinity for value types, for which <code class="highlighter-rouge">open</code> does not apply. I think this is why we haven‚Äôt seen a proposal to revert SE-0117, or further modify <code class="highlighter-rouge">open</code>.</p>

<p>Even though <code class="highlighter-rouge">open</code> can be successfully progressively disclosed, I would still argue that it lacks merit, at least in my experience. I almost always declare classes as <code class="highlighter-rouge">final</code>, especially if part of a public API. I have rarely encountered a situation where I would want to subclass a class within a module, but not outside of the module. Especially in a language as expressive and rich as Swift, there are plenty of other ways to design classes and modules to share behavior internally, but avoid exposing that behavior externally. A feature like <code class="highlighter-rouge">open</code> is definitely one that won‚Äôt be used the majority of the time, which makes its impact on the semantics of <code class="highlighter-rouge">public</code> even more regretful.</p>

<p>Furthermore, it‚Äôs worth pointing out that even though <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0117-non-public-subclassable-by-default.md">SE-0117</a> was discussed and reviewed <em>after</em> <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0025-scoped-access-level.md">SE-0025</a> was accepted and implemented, it was essentially proposed in isolation from SE-0025. Sure, the community knew about SE-0025 at the time, but no one had actually used Swift 3 and the new <code class="highlighter-rouge">private</code> and <code class="highlighter-rouge">fileprivate</code> access modifiers. (One could have played with this in a snapshot, but very few developers are doing that.) We were still completely in the dark about the implications and reality of SE-0025. While drunk on augmenting access control, the community pushed through yet another proposal to change it. To be clear, no one is to blame. We simply didn‚Äôt realize.</p>

<h3 id="access-control-in-swift-30">Access control in Swift 3.0</h3>

<p>This brings us to the current state of access control in Swift. Paraphrasing from <em>The Swift Programming Language</em> <a href="https://itunes.apple.com/us/book/the-swift-programming-language-swift-3-1/id881256329">eBook</a>:</p>

<ul>
  <li><code class="highlighter-rouge">open</code> access enables entities to be used within any source file from their defining module or from another module that imports the defining module. <code class="highlighter-rouge">open</code> only applies to classes and allows them to be subclassed from where they are accessible. Any <code class="highlighter-rouge">open</code> class can also declare its members as <code class="highlighter-rouge">open</code>, which allows them to be overridden.</li>
  <li><code class="highlighter-rouge">public</code> access is similar to <code class="highlighter-rouge">open</code>, except that subclassing and overriding are only allowed from within the defining module.</li>
  <li><code class="highlighter-rouge">internal</code> access (the default) enables entities to be used within any source file from their defining module, but not outside of that module.</li>
  <li><code class="highlighter-rouge">fileprivate</code> access restricts the use of an entity to its own defining source file.</li>
  <li><code class="highlighter-rouge">private</code> access restricts the use of an entity to the enclosing declaration or scope.</li>
</ul>

<p>In a very short time, Swift nearly doubled its number of access levels from three to five and altered the semantics of two previous keywords. I‚Äôve seen experienced programmers struggle to explain the difference between them or articulate their appropriate usage. You know something is wrong when it‚Äôs easier to explain <a href="http://chris.eidhof.nl/post/monads-in-swift/">monads</a> to a beginner than it is to explain access control levels. üòÑ</p>

<p>Returning to the philosophy of progressive disclosure, which of these access levels do we regularly need to consider? We can omit <code class="highlighter-rouge">open</code> for the reasons mentioned above. We can also omit <code class="highlighter-rouge">internal</code> since it is the default and does not need to be typed explicitly. This leaves <code class="highlighter-rouge">public</code>, <code class="highlighter-rouge">fileprivate</code>, and <code class="highlighter-rouge">private</code> for common, daily usage ‚Äî one more keyword than before, with more complex behavior than before.</p>

<h3 id="saving-fileprivate-or-the-great-compromise">Saving <code class="highlighter-rouge">fileprivate</code>, or the great compromise</h3>

<p>Most recently, proposal <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0159-fix-private-access-levels.md">SE-0159</a>: <em>Fix Private Access Levels</em> was put forward to simply revert the changes of <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0025-scoped-access-level.md">SE-0025</a>. That is, remove <code class="highlighter-rouge">fileprivate</code> and restore the original (Swift 1 and 2) semantics of <code class="highlighter-rouge">private</code>. Why? As I alluded to earlier, <code class="highlighter-rouge">fileprivate</code> turned out to be used quite often, breaking progressive disclosure. The new <code class="highlighter-rouge">private</code> essentially broke Swift‚Äôs extension-oriented style, as <code class="highlighter-rouge">private</code> members of a type were no longer accessible from an <code class="highlighter-rouge">extension</code> on that type, even if the <code class="highlighter-rouge">extension</code> was declared in the same file. The proposal was <a href="https://lists.swift.org/pipermail/swift-evolution-announce/2017-March/000332.html">reviewed</a> with as much controversy and ferver as SE-0025 itself. Ironically (or serendipitously?), <em><strong>nearly one year to the day</strong></em> after the <a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20160328/014008.html">final decision</a> for SE-0025 was announced, SE-0159 was <a href="https://lists.swift.org/pipermail/swift-evolution-announce/2017-April/000337.html">rejected</a>, leaving the state of access control unaltered. The proposal could not be accepted because the impact on source stability for Swift 4 would be too great. I agree, this is problematic.</p>

<p>However, there‚Äôs clearly an issue with access control ‚Äî SE-0025 did not turn out as expected ‚Äî and there is disagreement in the Swift community on how to address it. The <a href="https://swift.org/community/#community-structure">Core Team</a> is well aware. Doug Gregor <a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20170403/034903.html">started a new discussion</a> to hopefully find a compromise and settle Swift‚Äôs access control story for now, possibly for good:</p>

<blockquote>
  <p>The design, specifically, is that a ‚Äúprivate‚Äù member declared within a type ‚ÄúX‚Äù or an extension thereof would be accessible from:</p>

  <ul>
    <li>An extension of ‚ÄúX‚Äù in the same file</li>
    <li>The definition of ‚ÄúX‚Äù, if it occurs in the same file</li>
    <li>A nested type (or extension thereof) of one of the above that occurs in the same file</li>
  </ul>

  <p>This design has a number of apparent benefits:</p>
  <ul>
    <li><code class="highlighter-rouge">private</code> becomes the right default for ‚Äúless than whole module‚Äù visibility, and aligns well with Swift coding style that divides a type‚Äôs definition into a number of extensions.</li>
    <li><code class="highlighter-rouge">fileprivate</code> remains for existing use cases, but now its use is more rare, which has several advantages:
      <ul>
        <li>It fits well with the ‚Äúprogressive disclosure‚Äù philosophy behind Swift: you can use <code class="highlighter-rouge">public</code>/<code class="highlighter-rouge">internal</code>/<code class="highlighter-rouge">private</code> for a while before encountering and having to learn about <code class="highlighter-rouge">fileprivate</code> (note: we thought this was going to be true of <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0025-scoped-access-level.md">SE-0025</a>, but we were clearly wrong)</li>
        <li>When <code class="highlighter-rouge">fileprivate</code> occurs, it means there‚Äôs some interesting coupling between different types in the same file. That makes <code class="highlighter-rouge">fileprivate</code> a useful alert to the reader rather than, potentially, something that we routinely use and overlook so that we can separate implementations into extensions.</li>
      </ul>
    </li>
    <li><code class="highlighter-rouge">private</code> is more closely aligned with other programming languages that use type-based access control, which can help programmers just coming to Swift. When they reach for <code class="highlighter-rouge">private</code>, they‚Äôre likely to get something similar to what they expect‚Äîwith a little Swift twist due to Swift‚Äôs heavy use of extensions.</li>
    <li>Loosening the access restrictions on <code class="highlighter-rouge">private</code> is unlikely to break existing code.</li>
  </ul>

  <p>There are likely some drawbacks:</p>
  <ul>
    <li>Developers using patterns that depend on the existing lexically-scoped access control of <code class="highlighter-rouge">private</code> may find this new interpretation of <code class="highlighter-rouge">private</code> to be insufficiently strict</li>
    <li>Swift‚Äôs access control would go from ‚Äúentirely lexical‚Äù to ‚Äúpartly lexical and partly type-based‚Äù, which can be viewed as being more complicated</li>
  </ul>
</blockquote>

<p>Ultimately, I regret the changes that brought the <code class="highlighter-rouge">fileprivate</code> and <code class="highlighter-rouge">open</code> access levels to Swift. I wish we could revert both of these changes and instead consider any modifications to access control cohesively as part of a <a href="https://oleb.net/blog/2017/03/swift-themed-releases/">Swift theme</a>. As Doug notes, the hypothesis that <code class="highlighter-rouge">fileprivate</code> would rarely be used was incredibly wrong. This was primarily the result of extensions, which break the lexical scoping of <code class="highlighter-rouge">private</code>.</p>

<p>The <a href="https://lists.swift.org/pipermail/swift-evolution-announce/2016-March/000063.html">requested revisions</a> to <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0025-scoped-access-level.md">SE-0025</a> hinted at the potential scoping issues with extensions and the new behavior of <code class="highlighter-rouge">private</code>, but these implications were not widely discussed on the mailing lists, nor fully realized until developers actually started using Swift 3. Looking back, this was a major oversight. It certainly took me by surprise when I first realized I‚Äôd have to use <code class="highlighter-rouge">fileprivate</code> <em>everywhere</em>, due to how I had designed my types and extensions. In my experience the new <code class="highlighter-rouge">private</code>/<code class="highlighter-rouge">fileprivate</code> is a burden rather than a solution to any tangible problem. The strict lexical scoping of <code class="highlighter-rouge">private</code> feels broken in what has become idiomatic and conventional Swift, where extensions on types are heavily used to organize functionality. <a href="https://developer.apple.com/swift/blog/?id=29">Protocol extensions</a> amplify these symptoms of brokenness.</p>

<p>The Core Team‚Äôs proposal that Doug outlines above is a good compromise. Before I could publish this post, David Hart opened a <a href="https://github.com/apple/swift-evolution/pull/668/files">pull request</a> with a draft proposal titled <em>Type-based Private Access Level</em> for this. I hope it gets accepted and implemented. Although it introduces even more complexity into Swift‚Äôs access control system, I think most of the complexities are behind-the-scenes implementation details ‚Äî from a user‚Äôs perspective the <code class="highlighter-rouge">private</code> and <code class="highlighter-rouge">fileprivate</code> modifiers sound much easier to explain and reason about. Prior to actually using <code class="highlighter-rouge">private</code> as defined in SE-0025, I think most Swift users expected <code class="highlighter-rouge">private</code> members to be accessible from extensions. The benefits of a ‚Äúpartly lexical and partly type-based‚Äù access control that Doug explains are clear, and I think they outweigh the drawbacks.</p>

<p>We are obviously not in an optimal position. This is far from ideal, but it solves a real problem. If the suggestions above are implemented, we can escape from the corner we have painted ourselves into, albeit leaving a trail of paint-soaked footprints behind us. We will return to the state where only having to know about <code class="highlighter-rouge">public</code> and <code class="highlighter-rouge">private</code> will be necessary for <em>most</em> users <em>most</em> of the time. (Remember, <code class="highlighter-rouge">internal</code> is still the default and doesn‚Äôt need to be typed.) The usage of <code class="highlighter-rouge">fileprivate</code> would become rare and conspicuous, perhaps eventually considered <em>bad practice</em>.</p>

<h3 id="opportunity-costs">Opportunity costs</h3>

<p>I think it‚Äôs fair to say that the Swift community has learned a lot from the Swift 3.0 release ‚Äî not only the debates and churn around access control, but around the Swift Evolution Process in general. We should keep this in mind moving forward and continue to reflect on proposals, their outcomes, where we‚Äôve been, and how we arrived at where we are today. What do we want from this programming language? What should be prioritized and what should be deferred for the betterment of the language? Does your proposal fit with the <a href="https://oleb.net/blog/2017/03/swift-themed-releases/">theme</a> of the current Swift release?</p>

<p>Swift evolution is anything but cheap. Some consider it <a href="http://furbo.org/2017/02/17/swift-changes-considered-harmful/">actively harmful</a>. Every change has a cost, as does every deferment. Some changes are clearly expensive while others are more subtle. Swift 3 arrived with a very real cost ‚Äî a <a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20160516/017701.html">completely different set of goals</a> (see <a href="https://github.com/apple/swift-evolution/commit/06b69a6e51a71a462c268da60b51a18966dba31b">this diff</a>) and an <a href="https://mozilla-mobile.github.io/ios/firefox/swift/core/2017/02/22/migrating-to-swift-3.0.html">enormously</a> <a href="https://medium.com/airbnb-engineering/getting-to-swift-3-at-airbnb-79a257d2b656">painful</a> <a href="https://swift.org/migration-guide/">migration</a>. But these were just the actual costs, the results of changes made.</p>

<p>What is perhaps more important to consider are the changes that <a href="http://ericasadun.com/2016/05/16/winding-down-swift-3-0-abi-stability-deferred/"><em>were not</em> made</a>. The opportunity cost of each Swift release is the value of the changes we decide to forgo ‚Äî that is, the value of everything that <em>was not</em> implemented. This includes major features, as well as tasks like fixing bugs, addressing compile time issues, improving runtime performance, increasing overall stability, and more. That‚Äôs not to say that these things didn‚Äôt happen, <a href="https://swift.org/blog/whole-module-optimizations/">they</a> <a href="https://swift.org/blog/bridging-pch/">certainly</a> <a href="https://github.com/apple/swift/pull/6484">did</a> ‚Äî but <em>a lot</em> of time was spent on Swift Evolution Proposals, some of which should definitely have been deferred in hindsight.</p>

<p>None of this means the Swift community did something <em>wrong</em>, this is just how it is. We are all learning, even the Core Team. Fortunately, the Core Team is definitely being more strict and thoughtful for Swift 4 proposals, so I doubt we will find ourselves in a situation like this again. But, this is software development. There are always trade-offs.</p>

   </div> <!-- post-content -->
</article>


<div class="post-share-subscribe">
   <div class="row">
      <div class="col-md-6 col-sm-6 col-xs-12 center">
         <div class="btn-group btn-group-justified" role="group">

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Share &nbsp;<i class="fa fa-share-alt" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li>
                     <a href="https://twitter.com/intent/tweet?text=Thoughts%20on%20Swift%20access%20control%20http://localhost:4000/blog/thoughts-on-swift-access-control/%20via%20@anver_bogatov" title="Tweet" target="_blank">
                     Twitter &nbsp;<i class="fa fa-twitter" aria-hidden="true"></i>
                     </a>
                  </li>
                  <li>
                     <a href="https://www.facebook.com/sharer.php?u=http://localhost:4000/blog/thoughts-on-swift-access-control/" title="Post" target="_blank">
                     Facebook &nbsp;<i class="fa fa-facebook" aria-hidden="true"></i>
                     </a>
                  </li>
                  <li>
                     <a href="https://plus.google.com/share?url=http://localhost:4000/blog/thoughts-on-swift-access-control/" title="Share" target="_blank">
                     Google &nbsp;<i class="fa fa-google-plus" aria-hidden="true"></i>
                     </a>
                  </li>
               </ul>
            </div> <!-- share dropup -->

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Subscribe &nbsp;<i class="fa fa-rss" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li><a href="/feed.xml" title="Subscribe via RSS/atom">RSS/Atom &nbsp;<i class="fa fa-rss" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Add to Apple News">Apple News &nbsp;<i class="fa fa-apple" aria-hidden="true"></i></a></li>
               </ul>
            </div> <!-- subscribe drop-up -->

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Support &nbsp;<i class="fa fa-star" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li><a href="" title="Donate via PayPal" target="_blank">Donate via PayPal &nbsp;<i class="fa fa-paypal" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Donate via Square Cash" target="_blank">Donate via Square &nbsp;<i class="fa fa-dollar" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Donate Bitcoin" target="_blank">Donate Bitcoin &nbsp;<i class="fa fa-btc" aria-hidden="true"></i></a></li>
               </ul>
            </div> <!-- donate drop-up -->

         </div> <!-- btn-group -->
      </div> <!-- col -->
   </div> <!-- row -->

   <div class="row feedback">
      <div class="col-md-6 col-sm-6 col-xs-12 center">
         <p class="text-muted text-center"><small><b>Questions? Feedback? Corrections?</b></small></p>
         <p class="text-muted text-center"><small>
         Open an <a href="https://github.com/anverbogatov/anverbogatov.github.io/issues/new" target="_blank">issue</a> or
         submit a <a href="https://github.com/anverbogatov/anverbogatov.github.io/compare" target="_blank">pull request</a>.
         </small></p>
      </div> <!-- col -->
   </div> <!-- row -->

</div> <!-- post-share-subscribe -->


            </div> <!-- col -->
         </div> <!-- row -->
      </div> <!-- container -->

      
<footer class="container container-fluid">
   <hr>

   <div class="row contact">
    <div class="col-sm-12 col-sm-offset-0 col-md-8 col-md-offset-2">
        <ul class="inline center">
            <li><a href="https://github.com/anverbogatov" title="Follow me on Github"><i class="fa fa-2x fa-github" aria-hidden="true"></i></a></li>
            <li><a href="https://twitter.com/anver_bogatov" title="Follow me on Twitter"><i class="fa fa-2x fa-twitter" aria-hidden="true"></i></a></li>
            <li><a href="https://www.linkedin.com/in/anver-bogatov-64b32661/" title="Connect with me on LinkedIn"><i class="fa fa-2x fa-linkedin" aria-hidden="true"></i></a></li>
            <li><a href="/feed.xml" title="Subscribe via RSS/atom"><i class="fa fa-2x fa-rss-square" aria-hidden="true"></i></a></li>
            <li><a href="" title="Add to Apple News"><i class="fa fa-2x fa-apple" aria-hidden="true"></i></a></li>
        </ul>
    </div> <!-- col -->
</div> <!-- row -->


   <p class="text-muted text-center"><small>
   &copy; 2017 Anver Bogatov.
   This site is <a href="https://github.com/anverbogatov/anverbogatov.github.io">open source</a>.
   </small></p>
</footer>

      
<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

   </body>
</html>
