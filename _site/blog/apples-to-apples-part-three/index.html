<!DOCTYPE html>
<html lang="en">
   <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-control" content="public">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="keywords" content="hexed bits, apps, iOS, objective-c, swift, cocoa, apple, xcode, app store, software, programming, engineering, design patterns">
    <meta name="description" content="Бесконечность - не предел.">
    <meta name="author" content="Anver Bogatov">

    <title>
        
            Apples to apples, Part III &middot; Anver Bogatov
        
    </title>

    <!-- Begin Jekyll SEO tag v2.2.3 -->
<meta property="og:title" content="Apples to apples, Part III" />
<meta name="author" content="Anver Bogatov" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="When I find my code is slow or troubled, friends and colleagues comfort me. Speaking words of wisdom, write in C. It is understood that foregoing the features and abstractions of high-level programming languages in favor of their low-level counterparts can yield faster, more efficient code. If you abandon your favorite runtime, forget about garbage collection, eschew dynamic typing, and leave message passing behind; then you will be left with scalar operations, manual memory management, and raw pointers. However, the closer we get to the hardware, the further we get from readability, safety, and maintainability." />
<meta property="og:description" content="When I find my code is slow or troubled, friends and colleagues comfort me. Speaking words of wisdom, write in C. It is understood that foregoing the features and abstractions of high-level programming languages in favor of their low-level counterparts can yield faster, more efficient code. If you abandon your favorite runtime, forget about garbage collection, eschew dynamic typing, and leave message passing behind; then you will be left with scalar operations, manual memory management, and raw pointers. However, the closer we get to the hardware, the further we get from readability, safety, and maintainability." />
<link rel="canonical" href="http://localhost:4000/blog/apples-to-apples-part-three/" />
<meta property="og:url" content="http://localhost:4000/blog/apples-to-apples-part-three/" />
<meta property="og:site_name" content="Anver Bogatov" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-08-21T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@anver_bogatov" />
<meta name="twitter:creator" content="@anver_bogatov" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Apples to apples, Part III","author":{"@type":"Person","name":"Anver Bogatov"},"datePublished":"2014-08-21T00:00:00+00:00","dateModified":"2014-08-21T00:00:00+00:00","description":"When I find my code is slow or troubled, friends and colleagues comfort me. Speaking words of wisdom, write in C. It is understood that foregoing the features and abstractions of high-level programming languages in favor of their low-level counterparts can yield faster, more efficient code. If you abandon your favorite runtime, forget about garbage collection, eschew dynamic typing, and leave message passing behind; then you will be left with scalar operations, manual memory management, and raw pointers. However, the closer we get to the hardware, the further we get from readability, safety, and maintainability.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/img/logo.png"},"name":"Anver Bogatov"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/apples-to-apples-part-three/"},"url":"http://localhost:4000/blog/apples-to-apples-part-three/"}</script>
<!-- End Jekyll SEO tag -->


    <meta name="twitter:image" content="/img/logo.png" />
    <meta property="og:image" content="/img/logo.png" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="512" />
    <meta property="og:image:height" content="512" />

    <link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/bower_components/ubuntuMono/ubuntuMono.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="/bower_components/html5shiv/dist/html5shiv.min.js"></script>
      <script src="/bower_components/respond/dest/respond.min.js"></script>
    <![endif]-->

    <link rel="apple-touch-icon" sizes="76x76" href="/ico/icon76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/ico/icon120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/ico/icon152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/ico/icon167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/ico/icon180.png">

    <link rel="shortcut icon" href="/favicon.ico">
    <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Anver Bogatov" />

    <script>
         (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
         ga('create', 'UA-101828044-1', 'auto');
         ga('send', 'pageview');
    </script>
</head>

   <body>
      
<header class="container container-fluid">
   <div class="row">
      <div class="col-md-12 col-sm-12 col-xs-12">
        <h1 class="text-center"><a href="/">Anver Bogatov</a></h1>
        <div class="col-md-12 col-sm-12 col-xs-12">
            <h2 class="tagline">&mdash; Бесконечность - не предел. &mdash;</h2>
         </div> <!-- col -->
      </div> <!-- col -->
   </div> <!-- row -->

   <div class="row menu">
      <div class="col-md-12 col-sm-12 col-xs-12">
         <a class="btn btn-default" href="/">Блог</a>
         <!-- <a class="btn btn-default" href="/speaking/">Speaking</a> -->
         <a class="btn btn-default" href="/about/">Обо мне</a>
      </div> <!-- col -->
   </div> <!-- row -->
   <hr>
</header>


      <div class="container container-fluid">
         <div class="row">
            <div class="col-sm-12 col-sm-offset-0 col-md-10 col-md-offset-1">
               <article>
   <h1 class="post-title"><a href="">Apples to apples, Part III</a></h1>
   <h2 class="post-subtitle">A modest proposal&#58; can Swift outperform plain C? <small class="post-date">21 Aug 2014</small></h2>
   

   <div class="post-content">
      <p><em>When I find my code is slow or troubled, friends and colleagues comfort me. Speaking words of wisdom, write in C.</em> It is understood that foregoing the features and abstractions of <a href="http://en.wikipedia.org/wiki/High-level_programming_language">high-level</a> programming languages in favor of their <a href="http://en.wikipedia.org/wiki/Low-level_programming_language">low-level</a> counterparts can yield faster, more efficient code. If you abandon your favorite runtime, forget about garbage collection, eschew dynamic typing, and leave message passing behind; then you will be left with scalar operations, manual memory management, and raw pointers. However, the closer we get to the hardware, the further we get from readability, safety, and maintainability.</p>

<!--excerpt-->

<p>In <a href="/apples-to-apples-part-two/"><em>Apples to apples, Part II</em></a>, we discovered that Swift was finally performing better than Objective-C. As expected, some common <a href="https://twitter.com/OldManKris/status/497102303833255936">reactions</a> and <a href="https://twitter.com/mpweiher/status/497066155224608768">responses</a> on Twitter were, <em>then how does it compare to C?</em> This is precisely what we are investigating today to welcome this week’s arrival of <a href="https://developer.apple.com/xcode/downloads/">Xcode 6 beta 6</a>.</p>

<h3 id="setup">Setup</h3>

<ul>
  <li><em>Code:</em> <a href="https://github.com/jessesquires/swift-sorts">swift-sorts</a> and <a href="https://github.com/jessesquires/c-sorts">c-sorts</a></li>
  <li><em>Software:</em> OS X Mavericks 10.9.4, Xcode 6 beta 6</li>
  <li><em>Hardware:</em> 2008 unibody MacBook Pro, 2.4 Ghz Intel Core 2 Duo, 8 GB 1067 MHz DDR3 memory</li>
</ul>

<p>The benchmarks consist of <em><strong>T</strong></em> trials, which are averaged at the end to obtain the average execution time for each algorithm. Each trial begins by generating an array of <em><strong>N</strong></em> random integers in the range <code>[0, UINT32_MAX)</code>. Then, each sorting algorithm is passed a copy of this initial array to sort. The current time is logged before and after each sort and the difference between the two yields the execution time for the algorithm for the current trial. Each execution time is saved to find the average time and standard deviation after all trials are complete.</p>

<p>The sorting algorithms are written as <a href="http://en.wikipedia.org/wiki/Introduction_to_Algorithms">textbook implementations</a> for clarity, objectivity, and fairness to each language. The standard library sort for Swift uses the <code class="highlighter-rouge">sorted()</code> <a href="https://gist.github.com/jessesquires/06b6bd68a7d18810651f#file-sorts-m">function</a> while C uses <code class="highlighter-rouge">qsort()</code> from <a href="http://www.cplusplus.com/reference/cstdlib/qsort/">cstdlib</a>.</p>

<h3 id="results">Results</h3>

<p>Below are the results of running each program over 20 trials with 100,000 integers. The average execution times are displayed in seconds with the standard deviation listed underneath. All trials were run with the release build configuration, since we know Swift would be too slow in debug. The final row in each table is the difference in speed of Swift compared to C. A positive value indicates that Swift is faster, while a negative value indicates that Swift is slower. For example, if C runs in 1.2 seconds and Swift runs in 3.6 seconds, then Swift is 3 times (-3x) slower. Also note that the different compiler optimization levels have no affect on C, but are listed for consistency.</p>

<p class="text-muted text-center table-header-footer"><strong>Table 1</strong></p>
<div class="table-responsive">
	<table class="table table-bordered table-hover">
		<thead>
			<tr>
				<th class="text-muted">
					<em>T</em> = 20
					<br />
					<em>N</em> = 100,000
					<br />
					Release
				</th>
				<th>Std lib sort</th>
				<th>Quick sort<br /><code>O(n log n)</code></th>
				<th>Heap sort<br /><code>O(n log n)</code></th>
				<th>Insertion sort<br /><code>O(n<sup>2</sup>)</code></th>
				<th>Selection sort<br /><code>O(n<sup>2</sup>)</code></th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<th>C <code>-O3</code></th>
				<td>0.020853 s<br /><span class="text-muted">(&plusmn; 0.000191)</span></td>
				<td>0.011243 s<br /><span class="text-muted">(&plusmn; 0.000042)</span></td>
				<td>0.014909 s<br /><span class="text-muted">(&plusmn; 0.000360)</span></td>
				<td>7.575798 s<br /><span class="text-muted">(&plusmn; 0.016685)</span></td>
				<td>6.981794 s<br /><span class="text-muted">(&plusmn; 0.004399)</span></td>
			</tr>
			<tr>
				<th>Swift <code>-O</code></th>
				<td>0.014114 s<br /><span class="text-muted">(&plusmn; 0.000413)</span></td>
				<td>0.016745 s<br /><span class="text-muted">(&plusmn; 0.000202)</span></td>
				<td>0.042325 s<br /><span class="text-muted">(&plusmn; 0.003881)</span></td>
				<td>33.819305 s<br /><span class="text-muted">(&plusmn; 0.120471)</span></td>
				<td>25.255743 s<br /><span class="text-muted">(&plusmn; 0.084152)</span></td>
			</tr>
			<tr class="info text-info">
				<th>Difference</th>
				<td>1.48x</td>
				<td>-1.48x</td>
				<td>-2.84x</td>
				<td>-4.46x</td>
				<td>-3.62x</td>
			</tr>
		</tbody>
	</table>
</div>

<p><span class="text-muted">
	<strong>Note:</strong> I should point out that Swift has <strong>slightly regressed</strong> in beta 6 — but it is still substantially faster than Objective-C on all algorithms. When comparing the results above with <a href="/apples-to-apples-part-two/"><em>Table 4</em> from Part II</a>, we see that Swift is slower for each sort by the following rates: 1.01x, 1.06x, 1.15x, 1.23x, 1.33x, respectively. Remember, Swift is still in beta. Things happen. If previous releases are any indication, we will surely see improvements.
</span></p>

<p>Unexpectedly, <strong>Swift outperforms C</strong> for the standard library sort. This may reveal more about the standard library sorting algorithms than it does about the languages, but it is fascinating nonetheless. Examining the other sorts, C comes out ahead as most would have guessed — but its <strong>margins are small</strong>, relatively speaking. Recall how Swift nailed Objective-C in the previous post. At its slowest, Swift was still 6x faster than Objective-C, which means that Objective-C could not dream of performing this well. This is a big deal.</p>

<p class="text-muted text-center table-header-footer"><strong>Table 2</strong></p>
<div class="table-responsive">
	<table class="table table-bordered table-hover">
		<thead>
			<tr>
				<th class="text-muted">
					<em>T</em> = 20
					<br />
					<em>N</em> = 100,000
					<br />
					Release
				</th>
				<th>Std lib sort</th>
				<th>Quick sort<br /><code>O(n log n)</code></th>
				<th>Heap sort<br /><code>O(n log n)</code></th>
				<th>Insertion sort<br /><code>O(n<sup>2</sup>)</code></th>
				<th>Selection sort<br /><code>O(n<sup>2</sup>)</code></th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<th>C <code>-Ofast</code></th>
				<td>0.020861 s<br /><span class="text-muted">(&plusmn; 0.000216)</span></td>
				<td>0.011245 s<br /><span class="text-muted">(&plusmn; 0.000044)</span></td>
				<td>0.014932 s<br /><span class="text-muted">(&plusmn; 0.000308)</span></td>
				<td>7.578673 s<br /><span class="text-muted">(&plusmn; 0.012784)</span></td>
				<td>6.985793 s<br /><span class="text-muted">(&plusmn; 0.004598)</span></td>
			</tr>
			<tr>
				<th>Swift <code>-Ounchecked</code></th>
				<td>0.009508 s<br /><span class="text-muted">(&plusmn; 0.000367)</span></td>
				<td>0.011953 s<br /><span class="text-muted">(&plusmn; 0.000603)</span></td>
				<td>0.033006 s<br /><span class="text-muted">(&plusmn; 0.002562)</span></td>
				<td>30.831836 s<br /><span class="text-muted">(&plusmn; 0.057725)</span></td>
				<td>9.660987 s<br /><span class="text-muted">(&plusmn; 0.078939)</span></td>
			</tr>
			<tr class="info text-info">
				<th>Difference</th>
				<td>2.19x</td>
				<td>-1.06x</td>
				<td>-2.21x</td>
				<td>-4.07x</td>
				<td>-1.38x</td>
			</tr>
		</tbody>
	</table>
</div>

<p>Here we see what we should expect from <code class="highlighter-rouge">-Ounchecked</code>, given the results in <em>Table 1</em>. There is a similar pattern, only amplified. Swift gets even faster and even closer to C.</p>

<h3 id="approaching-the-speed-of-c">Approaching the speed of C</h3>

<p>It’s serendipitous that <code class="highlighter-rouge">c</code> denotes <a href="http://en.wikipedia.org/wiki/Speed_of_light">the speed of light</a> in physics, isn’t it? A common view in the programming community is that <em>nothing beats C</em>, and rightly so. It paved the road ahead and has endured the decades since its inception. I doubt that C is going anywhere, but this new kid on the block is pretty swift.</p>

<p>As programmers, we have a choice with regard to our toolsets. Programming languages come in a variety of forms with a <a href="https://www.destroyallsoftware.com/talks/wat">variety of features</a>. The opportunity costs of choosing one language are the features that you are foregoing in another. Swift is no C when it comes to speed, but when considering the features of each language, Swift’s superiority is undisputed.</p>

<p>And now we must patiently wait for the next beta.</p>

   </div> <!-- post-content -->
</article>


<div class="post-share-subscribe">
   <div class="row">
      <div class="col-md-6 col-sm-6 col-xs-12 center">
         <div class="btn-group btn-group-justified" role="group">

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Share &nbsp;<i class="fa fa-share-alt" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li>
                     <a href="https://twitter.com/intent/tweet?text=Apples%20to%20apples,%20Part%20III%20http://localhost:4000/blog/apples-to-apples-part-three/%20via%20@anver_bogatov" title="Tweet" target="_blank">
                     Twitter &nbsp;<i class="fa fa-twitter" aria-hidden="true"></i>
                     </a>
                  </li>
                  <li>
                     <a href="https://www.facebook.com/sharer.php?u=http://localhost:4000/blog/apples-to-apples-part-three/" title="Post" target="_blank">
                     Facebook &nbsp;<i class="fa fa-facebook" aria-hidden="true"></i>
                     </a>
                  </li>
                  <li>
                     <a href="https://plus.google.com/share?url=http://localhost:4000/blog/apples-to-apples-part-three/" title="Share" target="_blank">
                     Google &nbsp;<i class="fa fa-google-plus" aria-hidden="true"></i>
                     </a>
                  </li>
               </ul>
            </div> <!-- share dropup -->

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Subscribe &nbsp;<i class="fa fa-rss" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li><a href="/feed.xml" title="Subscribe via RSS/atom">RSS/Atom &nbsp;<i class="fa fa-rss" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Add to Apple News">Apple News &nbsp;<i class="fa fa-apple" aria-hidden="true"></i></a></li>
               </ul>
            </div> <!-- subscribe drop-up -->

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Support &nbsp;<i class="fa fa-star" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li><a href="" title="Donate via PayPal" target="_blank">Donate via PayPal &nbsp;<i class="fa fa-paypal" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Donate via Square Cash" target="_blank">Donate via Square &nbsp;<i class="fa fa-dollar" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Donate Bitcoin" target="_blank">Donate Bitcoin &nbsp;<i class="fa fa-btc" aria-hidden="true"></i></a></li>
               </ul>
            </div> <!-- donate drop-up -->

         </div> <!-- btn-group -->
      </div> <!-- col -->
   </div> <!-- row -->

   <div class="row feedback">
      <div class="col-md-6 col-sm-6 col-xs-12 center">
         <p class="text-muted text-center"><small><b>Questions? Feedback? Corrections?</b></small></p>
         <p class="text-muted text-center"><small>
         Open an <a href="https://github.com/anverbogatov/anverbogatov.github.io/issues/new" target="_blank">issue</a> or
         submit a <a href="https://github.com/anverbogatov/anverbogatov.github.io/compare" target="_blank">pull request</a>.
         </small></p>
      </div> <!-- col -->
   </div> <!-- row -->

</div> <!-- post-share-subscribe -->


            </div> <!-- col -->
         </div> <!-- row -->
      </div> <!-- container -->

      
<footer class="container container-fluid">
   <hr>

   <div class="row contact">
    <div class="col-sm-12 col-sm-offset-0 col-md-8 col-md-offset-2">
        <ul class="inline center">
            <li><a href="https://github.com/anverbogatov" title="Ищи меня на Github"><i class="fa fa-2x fa-github" aria-hidden="true"></i></a></li>
            <li><a href="https://twitter.com/anver_bogatov" title="Ищи меня в Twitter"><i class="fa fa-2x fa-twitter" aria-hidden="true"></i></a></li>
            <li><a href="https://www.linkedin.com/in/anver-bogatov-64b32661/" title="Свяжись со мной в LinkedIn"><i class="fa fa-2x fa-linkedin" aria-hidden="true"></i></a></li>
            <li><a href="/feed.xml" title="Подпишись с помощью RSS/atom"><i class="fa fa-2x fa-rss-square" aria-hidden="true"></i></a></li>
        </ul>
    </div> <!-- col -->
</div> <!-- row -->


   <p class="text-muted text-center"><small>
   &copy; 2017 Anver Bogatov.
   Это сайт с <a href="https://github.com/anverbogatov/anverbogatov.github.io">открытым исходным кодом</a>.
   </small></p>
</footer>

      
<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

   </body>
</html>
