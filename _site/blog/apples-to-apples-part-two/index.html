<!DOCTYPE html>
<html lang="en">
   <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-control" content="public">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="keywords" content="hexed bits, apps, iOS, objective-c, swift, cocoa, apple, xcode, app store, software, programming, engineering, design patterns">
    <meta name="description" content="Бесконечность - не предел.">
    <meta name="author" content="Anver Bogatov">

    <title>
        
            Apples to apples, Part II &middot; Anver Bogatov
        
    </title>

    <!-- Begin Jekyll SEO tag v2.2.3 -->
<meta property="og:title" content="Apples to apples, Part II" />
<meta name="author" content="Anver Bogatov" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="If at first you don’t succeed, try, try again. Practice makes perfect. These proverbs have encouraged us all in many different contexts. But in software development, they tug at our heartstrings uniquely. Programmers persevere through countless nights of fixing bugs. Companies march vigilantly toward an MVP. But after 1.0 there is no finish line, there is no bottom of the 9th inning. There are more bugs to be fixed. There are new releases ahead. The march continues, because software is not a product, it is a process." />
<meta property="og:description" content="If at first you don’t succeed, try, try again. Practice makes perfect. These proverbs have encouraged us all in many different contexts. But in software development, they tug at our heartstrings uniquely. Programmers persevere through countless nights of fixing bugs. Companies march vigilantly toward an MVP. But after 1.0 there is no finish line, there is no bottom of the 9th inning. There are more bugs to be fixed. There are new releases ahead. The march continues, because software is not a product, it is a process." />
<link rel="canonical" href="http://localhost:4000/blog/apples-to-apples-part-two/" />
<meta property="og:url" content="http://localhost:4000/blog/apples-to-apples-part-two/" />
<meta property="og:site_name" content="Anver Bogatov" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-08-06T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@anver_bogatov" />
<meta name="twitter:creator" content="@anver_bogatov" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Apples to apples, Part II","author":{"@type":"Person","name":"Anver Bogatov"},"datePublished":"2014-08-06T00:00:00+00:00","dateModified":"2014-08-06T00:00:00+00:00","description":"If at first you don’t succeed, try, try again. Practice makes perfect. These proverbs have encouraged us all in many different contexts. But in software development, they tug at our heartstrings uniquely. Programmers persevere through countless nights of fixing bugs. Companies march vigilantly toward an MVP. But after 1.0 there is no finish line, there is no bottom of the 9th inning. There are more bugs to be fixed. There are new releases ahead. The march continues, because software is not a product, it is a process.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/img/logo.png"},"name":"Anver Bogatov"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/apples-to-apples-part-two/"},"url":"http://localhost:4000/blog/apples-to-apples-part-two/"}</script>
<!-- End Jekyll SEO tag -->


    <meta name="twitter:image" content="/img/logo.png" />
    <meta property="og:image" content="/img/logo.png" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="512" />
    <meta property="og:image:height" content="512" />

    <link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/bower_components/ubuntuMono/ubuntuMono.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="/bower_components/html5shiv/dist/html5shiv.min.js"></script>
      <script src="/bower_components/respond/dest/respond.min.js"></script>
    <![endif]-->

    <link rel="apple-touch-icon" sizes="76x76" href="/ico/icon76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/ico/icon120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/ico/icon152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/ico/icon167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/ico/icon180.png">

    <link rel="shortcut icon" href="/favicon.ico">
    <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Anver Bogatov" />

    <script>
         (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
         ga('create', 'UA-101828044-1', 'auto');
         ga('send', 'pageview');
    </script>
</head>

   <body>
      
<header class="container container-fluid">
   <div class="row">
      <div class="col-md-12 col-sm-12 col-xs-12">
        <h1 class="text-center"><a href="/">Anver Bogatov</a></h1>
        <div class="col-md-12 col-sm-12 col-xs-12">
            <h2 class="tagline">&mdash; Бесконечность - не предел. &mdash;</h2>
         </div> <!-- col -->
      </div> <!-- col -->
   </div> <!-- row -->

   <div class="row menu">
      <div class="col-md-12 col-sm-12 col-xs-12">
         <a class="btn btn-default" href="/">Блог</a>
         <!-- <a class="btn btn-default" href="/speaking/">Speaking</a> -->
         <a class="btn btn-default" href="/about/">Обо мне</a>
      </div> <!-- col -->
   </div> <!-- row -->
   <hr>
</header>


      <div class="container container-fluid">
         <div class="row">
            <div class="col-sm-12 col-sm-offset-0 col-md-10 col-md-offset-1">
               <article>
   <h1 class="post-title"><a href="">Apples to apples, Part II</a></h1>
   <h2 class="post-subtitle">An analysis of sorts between Objective-C and Swift <small class="post-date">06 Aug 2014</small></h2>
   

   <div class="post-content">
      <p>If at first you don’t succeed, try, try again. Practice makes perfect. These proverbs have encouraged us all in many different contexts. But in software development, they tug at our heartstrings uniquely. Programmers persevere through countless nights of fixing bugs. Companies march vigilantly toward an <a href="http://en.wikipedia.org/wiki/Minimum_viable_product">MVP</a>. But after 1.0 there is no finish line, there is no bottom of the 9th inning. There are more bugs to be fixed. There are new releases ahead. The march continues, because software is not a <em>product</em>, it is a <em>process</em>.</p>

<!--excerpt-->

<p>This week, Apple has reminded us of the value of this iterative process and its rewards with the fifth beta release of Xcode 6, iOS 8, OS X Yosemite, and most importantly — <em>Swift</em>. This update includes a <a href="http://adcdownload.apple.com//Developer_Tools/xcode_6_beta_5_za4gu6/xcode_6_beta_5_release_notes.pdf">number of improvements</a>, but perhaps the most interesting are those not listed. Swift was rough around the edges during its launch at <a href="https://developer.apple.com/wwdc/">WWDC</a>, but it is <strong>definitely</strong> beginning to live up to its name.</p>

<p>If you missed my first post, <a href="/apples-to-apples/"><em>Apples to Apples</em></a>, you should head over there now to catch up.</p>

<h3 id="setup">Setup</h3>

<p>The setup is the same as before, but I’ll reiterate for clarity.</p>

<blockquote>
	<ul>
		<li><strong>Code:</strong> <a href="https://github.com/jessesquires/swift-sorts">swift-sorts</a>, <a href="https://github.com/jessesquires/objc-sorts">objc-sorts</a>, and <a href="https://gist.github.com/jessesquires/06b6bd68a7d18810651f#file-sorts-m">std lib sort</a> implementations</li>
		<li><strong>Software:</strong> OS X Mavericks 10.9.4, Xcode 6 beta 5</li>
		<li><strong>Hardware:</strong> 2008 unibody MacBook Pro, 2.4 Ghz Intel Core 2 Duo, 8 GB 1067 MHz DDR3 memory</li>
	</ul>

	<p>The benchmarks consist of <em><strong>T</strong></em> trials, which are averaged at the end to obtain the average execution time for each algorithm. Each trial begins by generating an array of <em><strong>N</strong></em> random integers in the range <code>[0, UINT32_MAX)</code>. Then, each sorting algorithm is passed a copy of this initial array to sort. The current time is logged before and after each sort and the difference between the two yields the execution time for the algorithm for the current trial.</p>

	<p>These two programs were carefully crafted to be a true <em>apples-to-apples</em> comparison. All of the algorithms, as well as <code>main.swift</code> and <code>main.m</code>, are implemented as similarly as possible, bounded only by the confines and paradigms of the languages themselves. In Objective-C, <code>NSArray</code> and <code>NSNumber</code> are used intentionally as the counterparts to Swift's <code>Array</code> and <code>Int</code>. The APIs are language-specific too, for example <code>exchangeObjectAtIndex: withObjectAtIndex:</code> versus <code>swap()</code>.</p>
</blockquote>

<h3 id="results">Results</h3>

<p>Below are the results of running each program over 10 trials with 10,000 integers. The build configuration settings are noted for each run and the average execution times are displayed in seconds. The average case runtime complexity for each algorithm is also noted.</p>

<p>The final row in each table is the difference in speed of Swift compared to Objective-C. A positive value indicates that Swift is faster, while a negative value indicates that Swift is slower. For example, if Objective-C runs in 3.6 seconds and Swift runs in 1.2 seconds, then Swift is 3 times (3x) faster.</p>

<p class="text-muted text-center table-header-footer"><strong>Table 1</strong></p>
<div class="table-responsive">
	<table class="table table-bordered table-hover">
		<thead>
			<tr>
				<th class="text-muted">
					<em>T</em> = 10
					<br />
					<em>N</em> = 10,000
					<br />
					Debug
				</th>
				<th>Std lib sort</th>
				<th>Quick sort<br /><code>O(n log n)</code></th>
				<th>Heap sort<br /><code>O(n log n)</code></th>
				<th>Insertion sort<br /><code>O(n<sup>2</sup>)</code></th>
				<th>Selection sort<br /><code>O(n<sup>2</sup>)</code></th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<th>Objective-C <code>-O0</code></th>
				<td>0.015161 s</td>
				<td>0.011438 s</td>
				<td>0.023984 s</td>
				<td>1.917997 s</td>
				<td>3.685714 s</td>
			</tr>
			<tr>
				<th>Swift <code>-Onone</code></th>
				<td>1.300011 s</td>
				<td>1.364851 s</td>
				<td>3.974969 s</td>
				<td>524.086557 s</td>
				<td>400.251450 s</td>
			</tr>
			<tr class="info text-info">
				<th>Difference</th>
				<td>-85.7x</td>
				<td>-119.3x</td>
				<td>-165.7x</td>
				<td>-273.2x</td>
				<td>-108.6x</td>
			</tr>
		</tbody>
	</table>
</div>

<p>When not optimized, Swift is nothing to write home about. You can see that Objective-C performs substantially better. But this is ok — since you will be shipping with optimized builds. With no optimizations, this is what we should expect to see. The swiftness of Swift is in the compiler — <a href="http://www.llvm.org">LLVM</a> and <a href="http://clang.llvm.org">Clang</a>. Mike Ash’s <em>Friday Q&amp;A</em> last month on the <a href="https://mikeash.com/pyblog/friday-qa-2014-07-04-secrets-of-swifts-speed.html"><em>Secrets of Swift’s Speed</em></a> provides a good overview of how better performance can be achieved with Swift versus Objective-C with compiler optimizations. We can see these optimizations in action below.</p>

<p class="text-muted text-center table-header-footer"><strong>Table 2</strong></p>
<div class="table-responsive">
	<table class="table table-bordered table-hover">
		<thead>
			<tr>
				<th class="text-muted">
					<em>T</em> = 10
					<br />
					<em>N</em> = 10,000
					<br />
					Release
				</th>
				<th>Std lib sort</th>
				<th>Quick sort<br /><code>O(n log n)</code></th>
				<th>Heap sort<br /><code>O(n log n)</code></th>
				<th>Insertion sort<br /><code>O(n<sup>2</sup>)</code></th>
				<th>Selection sort<br /><code>O(n<sup>2</sup>)</code></th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<th>Objective-C <code>-O3</code></th>
				<td>0.011852 s</td>
				<td>0.010419 s</td>
				<td>0.019587 s</td>
				<td>1.741661 s</td>
				<td>3.439606 s</td>
			</tr>
			<tr>
				<th>Swift <code>-O</code></th>
				<td>0.001072 s</td>
				<td>0.001316 s</td>
				<td>0.002580 s</td>
				<td>0.279190 s</td>
				<td>0.193269 s</td>
			</tr>
			<tr class="info text-info">
				<th>Difference</th>
				<td>11.1x</td>
				<td>7.9x</td>
				<td>7.6x</td>
				<td>6.2x</td>
				<td>17.8x</td>
			</tr>
		</tbody>
	</table>
</div>

<p>If you recall the results from the <a href="/apples-to-apples/">previous post</a>, then this should be quite shocking (in a good way). Take a deep breath. Yes, yes this is real life. The tables have completely turned (no pun intended). I’ve been running these trials since the first beta, and this is the <em>first time</em> that Swift has performed <strong>better than Objective-C</strong> for every single algorithm, with standard optimizations. And not only is Swift faster, but it is faster by significant margins.</p>

<p class="text-muted text-center table-header-footer"><strong>Table 3</strong></p>
<div class="table-responsive">
	<table class="table table-bordered table-hover">
		<thead>
			<tr>
				<th class="text-muted">
					<em>T</em> = 10
					<br />
					<em>N</em> = 10,000
					<br />
					Release
				</th>
				<th>Std lib sort</th>
				<th>Quick sort<br /><code>O(n log n)</code></th>
				<th>Heap sort<br /><code>O(n log n)</code></th>
				<th>Insertion sort<br /><code>O(n<sup>2</sup>)</code></th>
				<th>Selection sort<br /><code>O(n<sup>2</sup>)</code></th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<th>Objective-C <code>-Ofast</code></th>
				<td>0.012596 s</td>
				<td>0.010147 s</td>
				<td>0.019617 s</td>
				<td>1.763124 s</td>
				<td>3.504833 s</td>
			</tr>
			<tr>
				<th>Swift <code>-Ounchecked</code></th>
				<td>0.000773 s</td>
				<td>0.001011 s</td>
				<td>0.002073 s</td>
				<td>0.261637 s</td>
				<td>0.099996 s</td>
			</tr>
			<tr class="info text-info">
				<th>Difference</th>
				<td>16.3x</td>
				<td>10.0x</td>
				<td>9.5x</td>
				<td>6.7x</td>
				<td>35.0x</td>
			</tr>
		</tbody>
	</table>
</div>

<p class="text-muted text-center table-header-footer">As of beta 5, the Swift optimization level of <code>-Ofast</code> has been deprecated in favor <code>-Ounchecked</code>. This renaming is a delightful change. Previously it read as, <em>"Ooooh fast!"</em>, begging for misuse and misunderstanding. But now it's more like <em>"Oh... unchecked?"</em>, which better reflects its unsafe nature.</p>

<p>This should come as no surprise. Swift performance at this optimization level was always better than Objective-C, with the exception of the std lib sort — which no longer the case.</p>

<p>The benchmarks above were gathered with <code class="highlighter-rouge">N = 10,000</code> to be consistent with the previous post. However, this is no longer a challenge for Swift. Let’s see what happens when <code class="highlighter-rouge">N = 100,000</code>. Given that most, if not all, developers will be compliling their modules and apps at the standard optimization level, the trials below were only run with <code class="highlighter-rouge">-O</code> and release. As expected, Swift comes out on top.</p>

<p class="text-muted text-center table-header-footer"><strong>Table 4</strong></p>
<div class="table-responsive">
	<table class="table table-bordered table-hover">
		<thead>
			<tr>
				<th class="text-muted">
					<em>T</em> = 10
					<br />
					<em>N</em> = 100,000
					<br />
					Release
				</th>
				<th>Std lib sort</th>
				<th>Quick sort<br /><code>O(n log n)</code></th>
				<th>Heap sort<br /><code>O(n log n)</code></th>
				<th>Insertion sort<br /><code>O(n<sup>2</sup>)</code></th>
				<th>Selection sort<br /><code>O(n<sup>2</sup>)</code></th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<th>Objective-C <code>-O3</code></th>
				<td>0.151701 s</td>
				<td>0.121619 s</td>
				<td>0.251310 s</td>
				<td>175.421688 s</td>
				<td>349.182743 s</td>
			</tr>
			<tr>
				<th>Swift <code>-O</code></th>
				<td>0.013933 s</td>
				<td>0.015712 s</td>
				<td>0.036932 s</td>
				<td>27.532488 s</td>
				<td>18.969978 s</td>
			</tr>
			<tr class="info text-info">
				<th>Difference</th>
				<td>10.9x</td>
				<td>7.7x</td>
				<td>6.8x</td>
				<td>6.4x</td>
				<td>18.4x</td>
			</tr>
		</tbody>
	</table>
</div>

<h3 id="full-speed-ahead">Full speed ahead</h3>

<p>When Apple introduced Swift, we were assured safety, clarity, modernity, and speed. It is clear to me that they have delivered and are continuing to deliver on these promises. The refinements and enhancements made over the past few months have been absolutely great. Some highlights for me include array value semantics, array and dictionary syntactic sugar, the <code class="highlighter-rouge">..&lt;</code> operator replacing the <code class="highlighter-rouge">..</code> operator, and the performance improvements seen here. I think Swift is coming along quite nicely and I am more excited than ever for the next beta.</p>

<p>Swift is a breath of fresh air that makes reading and writing Objective-C feel archaic. I cannot wait for 1.0 and the moment when I can say goodbye to Objective-C.</p>

<p><strong>The <em>Apples to apples</em> series will continue as betas are released. Stay tuned for updates and new posts!</strong></p>

   </div> <!-- post-content -->
</article>


<div class="post-share-subscribe">
   <div class="row">
      <div class="col-md-6 col-sm-6 col-xs-12 center">
         <div class="btn-group btn-group-justified" role="group">

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Share &nbsp;<i class="fa fa-share-alt" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li>
                     <a href="https://twitter.com/intent/tweet?text=Apples%20to%20apples,%20Part%20II%20http://localhost:4000/blog/apples-to-apples-part-two/%20via%20@anver_bogatov" title="Tweet" target="_blank">
                     Twitter &nbsp;<i class="fa fa-twitter" aria-hidden="true"></i>
                     </a>
                  </li>
                  <li>
                     <a href="https://www.facebook.com/sharer.php?u=http://localhost:4000/blog/apples-to-apples-part-two/" title="Post" target="_blank">
                     Facebook &nbsp;<i class="fa fa-facebook" aria-hidden="true"></i>
                     </a>
                  </li>
                  <li>
                     <a href="https://plus.google.com/share?url=http://localhost:4000/blog/apples-to-apples-part-two/" title="Share" target="_blank">
                     Google &nbsp;<i class="fa fa-google-plus" aria-hidden="true"></i>
                     </a>
                  </li>
               </ul>
            </div> <!-- share dropup -->

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Subscribe &nbsp;<i class="fa fa-rss" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li><a href="/feed.xml" title="Subscribe via RSS/atom">RSS/Atom &nbsp;<i class="fa fa-rss" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Add to Apple News">Apple News &nbsp;<i class="fa fa-apple" aria-hidden="true"></i></a></li>
               </ul>
            </div> <!-- subscribe drop-up -->

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Support &nbsp;<i class="fa fa-star" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li><a href="" title="Donate via PayPal" target="_blank">Donate via PayPal &nbsp;<i class="fa fa-paypal" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Donate via Square Cash" target="_blank">Donate via Square &nbsp;<i class="fa fa-dollar" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Donate Bitcoin" target="_blank">Donate Bitcoin &nbsp;<i class="fa fa-btc" aria-hidden="true"></i></a></li>
               </ul>
            </div> <!-- donate drop-up -->

         </div> <!-- btn-group -->
      </div> <!-- col -->
   </div> <!-- row -->

   <div class="row feedback">
      <div class="col-md-6 col-sm-6 col-xs-12 center">
         <p class="text-muted text-center"><small><b>Questions? Feedback? Corrections?</b></small></p>
         <p class="text-muted text-center"><small>
         Open an <a href="https://github.com/anverbogatov/anverbogatov.github.io/issues/new" target="_blank">issue</a> or
         submit a <a href="https://github.com/anverbogatov/anverbogatov.github.io/compare" target="_blank">pull request</a>.
         </small></p>
      </div> <!-- col -->
   </div> <!-- row -->

</div> <!-- post-share-subscribe -->


            </div> <!-- col -->
         </div> <!-- row -->
      </div> <!-- container -->

      
<footer class="container container-fluid">
   <hr>

   <div class="row contact">
    <div class="col-sm-12 col-sm-offset-0 col-md-8 col-md-offset-2">
        <ul class="inline center">
            <li><a href="https://github.com/anverbogatov" title="Ищи меня на Github"><i class="fa fa-2x fa-github" aria-hidden="true"></i></a></li>
            <li><a href="https://twitter.com/anver_bogatov" title="Ищи меня в Twitter"><i class="fa fa-2x fa-twitter" aria-hidden="true"></i></a></li>
            <li><a href="https://www.linkedin.com/in/anver-bogatov-64b32661/" title="Свяжись со мной в LinkedIn"><i class="fa fa-2x fa-linkedin" aria-hidden="true"></i></a></li>
            <li><a href="/feed.xml" title="Подпишись с помощью RSS/atom"><i class="fa fa-2x fa-rss-square" aria-hidden="true"></i></a></li>
        </ul>
    </div> <!-- col -->
</div> <!-- row -->


   <p class="text-muted text-center"><small>
   &copy; 2017 Anver Bogatov.
   Это сайт с <a href="https://github.com/anverbogatov/anverbogatov.github.io">открытым исходным кодом</a>.
   </small></p>
</footer>

      
<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

   </body>
</html>
