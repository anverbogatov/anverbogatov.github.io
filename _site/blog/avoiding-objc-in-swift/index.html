<!DOCTYPE html>
<html lang="en">
   <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-control" content="public">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="keywords" content="hexed bits, apps, iOS, objective-c, swift, cocoa, apple, xcode, app store, software, programming, engineering, design patterns">
    <meta name="description" content="Бесконечность - не предел.">
    <meta name="author" content="Anver Bogatov">

    <title>
        
            Avoiding the overuse of @objc in Swift &middot; Anver Bogatov
        
    </title>

    <!-- Begin Jekyll SEO tag v2.2.3 -->
<meta property="og:title" content="Avoiding the overuse of @objc in Swift" />
<meta name="author" content="Anver Bogatov" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A few days ago I was (finally!) updating a project to use Swift 2.2 and I ran into a few issues when converting to use the new #selector syntax introduced by proposal SE-0022. If using #selector from within a protocol extension, that protocol must be declared as @objc. The former Selector(&quot;method:&quot;) syntax did not have this requirement." />
<meta property="og:description" content="A few days ago I was (finally!) updating a project to use Swift 2.2 and I ran into a few issues when converting to use the new #selector syntax introduced by proposal SE-0022. If using #selector from within a protocol extension, that protocol must be declared as @objc. The former Selector(&quot;method:&quot;) syntax did not have this requirement." />
<link rel="canonical" href="http://localhost:4000/blog/avoiding-objc-in-swift/" />
<meta property="og:url" content="http://localhost:4000/blog/avoiding-objc-in-swift/" />
<meta property="og:site_name" content="Anver Bogatov" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-06-04T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@anver_bogatov" />
<meta name="twitter:creator" content="@anver_bogatov" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Avoiding the overuse of @objc in Swift","author":{"@type":"Person","name":"Anver Bogatov"},"datePublished":"2016-06-04T00:00:00+00:00","dateModified":"2016-06-04T00:00:00+00:00","description":"A few days ago I was (finally!) updating a project to use Swift 2.2 and I ran into a few issues when converting to use the new #selector syntax introduced by proposal SE-0022. If using #selector from within a protocol extension, that protocol must be declared as @objc. The former Selector(&quot;method:&quot;) syntax did not have this requirement.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/img/logo.png"},"name":"Anver Bogatov"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/avoiding-objc-in-swift/"},"url":"http://localhost:4000/blog/avoiding-objc-in-swift/"}</script>
<!-- End Jekyll SEO tag -->


    <meta name="twitter:image" content="/img/logo.png" />
    <meta property="og:image" content="/img/logo.png" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="512" />
    <meta property="og:image:height" content="512" />

    <link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/bower_components/ubuntuMono/ubuntuMono.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="/bower_components/html5shiv/dist/html5shiv.min.js"></script>
      <script src="/bower_components/respond/dest/respond.min.js"></script>
    <![endif]-->

    <link rel="apple-touch-icon" sizes="76x76" href="/ico/icon76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/ico/icon120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/ico/icon152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/ico/icon167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/ico/icon180.png">

    <link rel="shortcut icon" href="/favicon.ico">
    <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Anver Bogatov" />

    <script>
         (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
         ga('create', 'UA-37319916-5', 'auto');
         ga('send', 'pageview');
    </script>
</head>

   <body>
      
<header class="container container-fluid">
   <div class="row">
      <div class="col-md-12 col-sm-12 col-xs-12">
        <h1 class="text-center"><a href="/">Anver Bogatov</a></h1>
        <div class="col-md-12 col-sm-12 col-xs-12">
            <h2 class="tagline">&mdash; Бесконечность - не предел. &mdash;</h2>
         </div> <!-- col -->
      </div> <!-- col -->
   </div> <!-- row -->

   <div class="row menu">
      <div class="col-md-12 col-sm-12 col-xs-12">
         <a class="btn btn-default" href="/">Блог</a>
         <!-- <a class="btn btn-default" href="/speaking/">Speaking</a> -->
         <a class="btn btn-default" href="/about/">Обо мне</a>
      </div> <!-- col -->
   </div> <!-- row -->
   <hr>
</header>


      <div class="container container-fluid">
         <div class="row">
            <div class="col-sm-12 col-sm-offset-0 col-md-10 col-md-offset-1">
               <article>
   <h1 class="post-title"><a href="">Avoiding the overuse of @objc in Swift</a></h1>
   <h2 class="post-subtitle">Don't let Objective-C cramp your style <small class="post-date">04 Jun 2016</small></h2>
   

   <div class="post-content">
      <p>A few days ago I was (finally!) updating a project to use Swift 2.2 and I ran into a few issues when converting to use the new <code class="highlighter-rouge">#selector</code> syntax introduced by proposal <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0022-objc-selectors.md">SE-0022</a>. If using <code class="highlighter-rouge">#selector</code> from within a protocol extension, that protocol must be declared as <code class="highlighter-rouge">@objc</code>. The former <code class="highlighter-rouge">Selector("method:")</code> syntax did not have this requirement.</p>

<!--excerpt-->

<h3 id="configuring-view-controllers-with-protocol-extensions">Configuring view controllers with protocol extensions</h3>

<p>For the purposes of this post, I’ve simplified the code from the project I’m working on, but all of the core ideas remain. One pattern I’ve been using a lot in Swift is writing protocols and extensions for reusable configurations, especially with UIKit.</p>

<p>Suppose we have a group of view controllers that all need a view model and a “cancel” button. Each controller needs to be able to execute its own code when “cancel” is tapped. We may write something like this:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">ViewModel</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">ViewControllerType</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">viewModel</span><span class="p">:</span> <span class="kt">ViewModel</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">didTapCancelButton</span><span class="p">(</span><span class="nv">sender</span><span class="p">:</span> <span class="kt">UIBarButtonItem</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>If we stopped here, then each controller would have to add and wire up its own cancel button. That ends up being a lot of boilerplate. We can fix that with an extension (using the old <code class="highlighter-rouge">Selector("")</code> syntax):</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">extension</span> <span class="kt">ViewControllerType</span> <span class="k">where</span> <span class="k">Self</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">configureNavigationItem</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">navigationItem</span><span class="o">.</span><span class="n">leftBarButtonItem</span> <span class="o">=</span> <span class="kt">UIBarButtonItem</span><span class="p">(</span>
            <span class="nv">barButtonSystemItem</span><span class="p">:</span> <span class="o">.</span><span class="kt">Cancel</span><span class="p">,</span>
            <span class="nv">target</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span>
            <span class="nv">action</span><span class="p">:</span> <span class="kt">Selector</span><span class="p">(</span><span class="s">"didTapCancelButton:"</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Now each controller that conforms to this protocol can call <code class="highlighter-rouge">configureNavigationItem()</code> from <code class="highlighter-rouge">viewDidLoad()</code>, which is much better. Our controller might look like this:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">MyViewController</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="kt">ViewControllerType</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">viewModel</span> <span class="o">=</span> <span class="kt">ViewModel</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Title"</span><span class="p">)</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="nf">configureNavigationItem</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">didTapCancelButton</span><span class="p">(</span><span class="nv">sender</span><span class="p">:</span> <span class="kt">UIBarButtonItem</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handle tap</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This is rather simple, but you can imagine more complex configurations that we could apply using this strategy.</p>

<p>After updating the snippet above for Swift 2.2, we have the following:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">extension</span> <span class="kt">ViewControllerType</span> <span class="k">where</span> <span class="k">Self</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">configureNavigationItem</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">navigationItem</span><span class="o">.</span><span class="n">leftBarButtonItem</span> <span class="o">=</span> <span class="kt">UIBarButtonItem</span><span class="p">(</span>
            <span class="nv">barButtonSystemItem</span><span class="p">:</span> <span class="o">.</span><span class="kt">Cancel</span><span class="p">,</span>
            <span class="nv">target</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span>
            <span class="nv">action</span><span class="p">:</span> <span class="kd">#selector(</span><span class="nf">didTapCancelButton(_:)</span><span class="kd">)</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>And now we have a problem, a new compiler error.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Argument of <span class="s1">'#selector'</span> refers to a method that is not exposed to Objective-C.

Fix-it   Add <span class="s1">'@objc'</span> to expose this method to Objective-C</code></pre></figure>

<h3 id="when-objc-tries-to-ruin-everything">When <code class="highlighter-rouge">@objc</code> tries to ruin everything</h3>

<p>We cannot simply add <code class="highlighter-rouge">@objc</code> to this method in the original <code class="highlighter-rouge">ViewControllerType</code> protocol for a number of reasons. If we do, then the entire protocol needs to be marked <code class="highlighter-rouge">@objc</code>, which means:</p>

<ul>
  <li>Any protocols from which this one inherits need to be marked <code class="highlighter-rouge">@objc</code>.</li>
  <li>Any protocols that <em>inherit from</em> this one are now automatically <code class="highlighter-rouge">@objc</code>.</li>
  <li>We’re using structs (the <code class="highlighter-rouge">ViewModel</code>) in the protocol which cannot be expressed in Objective-C.</li>
</ul>

<p>Until this point, the only occurrences of <code class="highlighter-rouge">@objc</code> in this code base were confined to normal target-action selectors. We may not be writing <em>Pure Swift<sup>TM</sup></em> apps yet since it’s still <a href="http://inessential.com/2016/05/25/oldie_complains_about_the_old_old_ways">Cocoa all the way down</a>, but we can still take advantage of many of Swift’s powerful features — unless we start introducing <code class="highlighter-rouge">@objc</code> in too many places.</p>

<p>Our example here is simple, but imagine a much more complex object graph that makes heavy use of Swift’s value types and a hierarchy of three protocols with this one in the middle. Introducing <code class="highlighter-rouge">@objc</code> as the fix-it suggests would <em>break the entire world</em> in our app. If we let it, the tyranny of <code class="highlighter-rouge">@objc</code> will expel all beauty from our Swift code and make everything horrible. It will ruin everything.</p>

<p>But there’s hope.</p>

<h3 id="stop-objc-from-making-everything-horrible">Stop <code class="highlighter-rouge">@objc</code> from making everything horrible</h3>

<p>We do not have to let <code class="highlighter-rouge">@objc</code> proliferate our code base and transform our Swift code into merely “Objective-C with a new syntax”.</p>

<p>We can decompose this protocol by separating out all of the <code class="highlighter-rouge">@objc</code> code into its own protocol. Then, we can use protocol composition to reunite them. In fact, we can make the compiler happy and avoid changing <em>any</em> of our view controller code.</p>

<p>First we split up the protocol into two protocols, <code class="highlighter-rouge">ViewModelConfigurable</code> and <code class="highlighter-rouge">NavigationItemConfigurable</code>. Our previous extension on <code class="highlighter-rouge">ViewControllerType</code> can move to <code class="highlighter-rouge">NavigationItemConfigurable</code> instead.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">protocol</span> <span class="kt">ViewModelConfigurable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">viewModel</span><span class="p">:</span> <span class="kt">ViewModel</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">@objc</span> <span class="kd">protocol</span> <span class="kt">NavigationItemConfigurable</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">didTapCancelButton</span><span class="p">(</span><span class="nv">sender</span><span class="p">:</span> <span class="kt">UIBarButtonItem</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">NavigationItemConfigurable</span> <span class="k">where</span> <span class="k">Self</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">configureNavigationItem</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">navigationItem</span><span class="o">.</span><span class="n">leftBarButtonItem</span> <span class="o">=</span> <span class="kt">UIBarButtonItem</span><span class="p">(</span>
            <span class="nv">barButtonSystemItem</span><span class="p">:</span> <span class="o">.</span><span class="kt">Cancel</span><span class="p">,</span>
            <span class="nv">target</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span>
            <span class="nv">action</span><span class="p">:</span> <span class="kd">#selector(</span><span class="nf">didTapCancelButton(_:)</span><span class="kd">)</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Finally, we can define our original <code class="highlighter-rouge">ViewControllerType</code> protocol as a <code class="highlighter-rouge">typealias</code>.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">typealias</span> <span class="kt">ViewControllerType</span> <span class="o">=</span> <span class="kd">protocol</span><span class="o">&lt;</span><span class="kt">ViewModelConfigurable</span><span class="p">,</span> <span class="kt">NavigationItemConfigurable</span><span class="o">&gt;</span></code></pre></figure>

<p>Now everything works exactly as it did before migrating to Swift 2.2 and our original view controller definition above does not have to change. Nothing is ruined. If you ever face a similar situation, or if you generally want to contain the use of <code class="highlighter-rouge">@objc</code> (<em>which you should</em>), then I highly recommend adopting this strategy.</p>

<h3 id="its-not-always-obvious">It’s not always obvious</h3>

<p>Looking at this now, I think “duh”, of course this is the best and “most Swifty” answer to the problem. However, a solution like this is not always immediately clear when Xcode suddenly starts yelling at you and quickly applying the fix-its starts breaking <em>everything else</em> — especially when Xcode’s fix-its are usually what you want when migrating Swift versions.</p>

<p>Lastly, after making this change I realized it’s actually a much better solution in general. There was no reason for this to be a single protocol in the first place. The <code class="highlighter-rouge">ViewModelConfigurable</code> and <code class="highlighter-rouge">NavigationItemConfigurable</code> protocols have distinct responsibilities. Protocol composition was the most elegant and appropriate design all along.</p>

   </div> <!-- post-content -->
</article>


<div class="post-share-subscribe">
   <div class="row">
      <div class="col-md-6 col-sm-6 col-xs-12 center">
         <div class="btn-group btn-group-justified" role="group">

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Share &nbsp;<i class="fa fa-share-alt" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li>
                     <a href="https://twitter.com/intent/tweet?text=Avoiding%20the%20overuse%20of%20@objc%20in%20Swift%20http://localhost:4000/blog/avoiding-objc-in-swift/%20via%20@anver_bogatov" title="Tweet" target="_blank">
                     Twitter &nbsp;<i class="fa fa-twitter" aria-hidden="true"></i>
                     </a>
                  </li>
                  <li>
                     <a href="https://www.facebook.com/sharer.php?u=http://localhost:4000/blog/avoiding-objc-in-swift/" title="Post" target="_blank">
                     Facebook &nbsp;<i class="fa fa-facebook" aria-hidden="true"></i>
                     </a>
                  </li>
                  <li>
                     <a href="https://plus.google.com/share?url=http://localhost:4000/blog/avoiding-objc-in-swift/" title="Share" target="_blank">
                     Google &nbsp;<i class="fa fa-google-plus" aria-hidden="true"></i>
                     </a>
                  </li>
               </ul>
            </div> <!-- share dropup -->

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Subscribe &nbsp;<i class="fa fa-rss" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li><a href="/feed.xml" title="Subscribe via RSS/atom">RSS/Atom &nbsp;<i class="fa fa-rss" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Add to Apple News">Apple News &nbsp;<i class="fa fa-apple" aria-hidden="true"></i></a></li>
               </ul>
            </div> <!-- subscribe drop-up -->

            <div class="btn-group dropup" role="group">
               <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Support &nbsp;<i class="fa fa-star" aria-hidden="true"></i>
               </button>
               <ul class="dropdown-menu">
                  <li><a href="" title="Donate via PayPal" target="_blank">Donate via PayPal &nbsp;<i class="fa fa-paypal" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Donate via Square Cash" target="_blank">Donate via Square &nbsp;<i class="fa fa-dollar" aria-hidden="true"></i></a></li>
                  <li><a href="" title="Donate Bitcoin" target="_blank">Donate Bitcoin &nbsp;<i class="fa fa-btc" aria-hidden="true"></i></a></li>
               </ul>
            </div> <!-- donate drop-up -->

         </div> <!-- btn-group -->
      </div> <!-- col -->
   </div> <!-- row -->

   <div class="row feedback">
      <div class="col-md-6 col-sm-6 col-xs-12 center">
         <p class="text-muted text-center"><small><b>Questions? Feedback? Corrections?</b></small></p>
         <p class="text-muted text-center"><small>
         Open an <a href="https://github.com/anverbogatov/anverbogatov.github.io/issues/new" target="_blank">issue</a> or
         submit a <a href="https://github.com/anverbogatov/anverbogatov.github.io/compare" target="_blank">pull request</a>.
         </small></p>
      </div> <!-- col -->
   </div> <!-- row -->

</div> <!-- post-share-subscribe -->


            </div> <!-- col -->
         </div> <!-- row -->
      </div> <!-- container -->

      
<footer class="container container-fluid">
   <hr>

   <div class="row contact">
    <div class="col-sm-12 col-sm-offset-0 col-md-8 col-md-offset-2">
        <ul class="inline center">
            <li><a href="https://github.com/anverbogatov" title="Follow me on Github"><i class="fa fa-2x fa-github" aria-hidden="true"></i></a></li>
            <li><a href="https://twitter.com/anver_bogatov" title="Follow me on Twitter"><i class="fa fa-2x fa-twitter" aria-hidden="true"></i></a></li>
            <li><a href="https://www.linkedin.com/in/anver-bogatov-64b32661/" title="Connect with me on LinkedIn"><i class="fa fa-2x fa-linkedin" aria-hidden="true"></i></a></li>
            <li><a href="/feed.xml" title="Subscribe via RSS/atom"><i class="fa fa-2x fa-rss-square" aria-hidden="true"></i></a></li>
            <li><a href="" title="Add to Apple News"><i class="fa fa-2x fa-apple" aria-hidden="true"></i></a></li>
        </ul>
    </div> <!-- col -->
</div> <!-- row -->


   <p class="text-muted text-center"><small>
   &copy; 2017 Anver Bogatov.
   This site is <a href="https://github.com/anverbogatov/anverbogatov.github.io">open source</a>.
   </small></p>
</footer>

      
<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

   </body>
</html>
